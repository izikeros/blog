
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="color-scheme" content="light dark"/>
    <script>
      (function() {
        var theme = localStorage.getItem('theme-preference');
        if (theme === 'dark' || theme === 'light') {
          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"/>
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
              rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/stylesheet/style.css">


    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/pygments/github.min.css">


    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/solid.css">

    <link rel="stylesheet" href="https://www.safjan.com/pagefind/pagefind-ui.css">

        <link rel="stylesheet" type="text/css"
              href="https://www.safjan.com/styles/custom.css">

        <link href="https://www.safjan.com/feeds/all.atom.xml?utm_source=rss&utm_medium=feed&utm_campaign=rss-feed" type="application/atom+xml" rel="alternate"
              title="Krystian Safjan's Blog Atom">

        <link href="https://www.safjan.com/feeds/all.rss.xml?utm_source=rss&utm_medium=feed&utm_campaign=rss-feed" type="application/rss+xml" rel="alternate"
              title="Krystian Safjan's Blog RSS">


    <link rel="apple-touch-icon" sizes="180x180" href="https://www.safjan.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.safjan.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.safjan.com/favicon-16x16.png">
    <link rel="shortcut icon" href="https://www.safjan.com/favicon.ico">
    <link rel="manifest" href="https://www.safjan.com/site.webmanifest">
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-title" content="Krystian Safjan's Blog">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RM2PKDCCYM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RM2PKDCCYM');
</script>
<!-- End of Google tag (gtag.js) -->



    <meta name="author" content="Krystian Safjan"/>
    <meta name="description" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate experiments, compare results, and speed up refactoring work with agents and Copilot."/>
    <meta name="keywords" content="git, worktrees, ai-coding, refactoring, workflows, vscode, productivity">


  <meta property="og:site_name" content="Krystian Safjan's Blog"/>
  <meta property="og:title" content="Working Faster with Git Worktrees and AI-Based Multi-Workflow Development"/>
  <meta property="og:description" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate experiments, compare results, and speed up refactoring work with agents and Copilot."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://www.safjan.com/git-worktrees-ai-multi-workflows/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2025-11-28 00:00:00+01:00"/>
  <meta property="article:modified_time" content="2025-11-28 00:00:00+01:00"/>
  <meta property="article:author" content="https://www.safjan.com/author/krystian-safjan/"/>
  <meta property="article:section" content="note"/>
  <meta property="article:tag" content="git, worktrees, ai-coding, refactoring, workflows, vscode, productivity"/>
  <meta property="og:image" content="/images/profile_new.jpg"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image" content="/images/profile_new.jpg"/>
    <meta name="twitter:image:alt" content="Krystian Safjan's Blog"/>


    <meta name="twitter:site" content="@izikeros"/>
    <meta name="twitter:creator" content="@izikeros"/>
    <meta name="twitter:title" content="Working Faster with Git Worktrees and AI-Based Multi-Workflow Development"/>
    <meta name="twitter:description" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate..."/>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.safjan.com/git-worktrees-ai-multi-workflows/"
  },
  "headline": "Working Faster with Git Worktrees and AI-Based Multi-Workflow Development",
  "datePublished": "2025-11-28T00:00:00+01:00",
  "dateModified": "2025-11-28T00:00:00+01:00",
  "author": {
    "@type": "Person",
    "name": "Krystian Safjan",
    "url": "https://www.safjan.com/author/krystian-safjan/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Krystian Safjan's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/profile_new.jpg"
    }  },
"image": "/images/profile_new.jpg",  "url": "https://www.safjan.com/git-worktrees-ai-multi-workflows/",
  "description": "A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The...",
  "articleSection": "note",
  "inLanguage": "en",
  "keywords": "git, worktrees, ai-coding, refactoring, workflows, vscode, productivity",
  "wordCount": 1764,
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": ["article h1", ".summary", ".tldr", "article \u003e p:first-of-type"]
  }}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://www.safjan.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "note",
      "item": "https://www.safjan.com/category/note.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Working Faster with Git Worktrees and AI-Based..."
    }
  ]
}
</script>



<meta name="ai:summary" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate experiments, compare results, and speed up refactoring work with agents and Copilot.">

<meta name="ai:topics" content="git, worktrees, ai-coding, refactoring, workflows, vscode, productivity">



<meta name="ai:word-count" content="1764">
<meta name="ai:reading-time" content="8 min">

<meta name="ai:section" content="note">



<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">

    <title>    Working Faster with Git Worktrees and AI-Based Multi-Workflow Development
</title>



<!-- Google Automatic Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9767732578835199"
     crossorigin="anonymous"></script>
<!-- End of Google Automatic Ads -->


</head>
<body>
<div id="reading-progress" class="reading-progress"></div>
<aside>
    <div>
        <a href="https://www.safjan.com/">
                <img src="/images/profile_new.jpg" alt="Krystian Safjan's Blog" title="Krystian Safjan's Blog" width="140" height="140">
        </a>

        <h1>
            <a href="https://www.safjan.com/">Krystian Safjan's Blog</a>
        </h1>

<p>Data Scientist and Team Leader writing about Machine Learning, MLOps, and Python</p>


        <ul class="social">
                <li>
                    <a  class="sc-linkedin" href="https://pl.linkedin.com/in/krystiansafjan"
                       target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/izikeros"
                       target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-envelope" href="mailto:ksafjan@gmail.com"
                       target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-graduation-cap" href="https://scholar.google.pl/citations?user=UlNJgMoAAAAJ"
                       target="_blank">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-rss" href="/feeds/all.rss.xml"
                       target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>

<div class="promo-box">
    <a href="https://ksafjanuser.gumroad.com/l/mlops" class="promo-box-image">
        <img src="/images/mlop_interview_book_cover_3D_300px.jpg" alt="MLOps Interview Book Cover">
    </a>
    
    <p class="promo-box-headline">Ace Your MLOps Interview</p>
    
    <a href="https://ksafjanuser.gumroad.com/l/mlops" class="promo-box-cta">
        Get for $2.99
    </a>
    
    <p class="promo-box-features">50 Q&A • PDF/ePUB/mobi</p>
</div>
</aside>
<main>

        <nav aria-label="Main navigation">
            <a href="https://www.safjan.com/">Home</a>

                <a href="/archives.html">Articles</a>
                <a href="/til.html">Notes</a>
                <a href="/categories.html">Categories</a>
                <a href="/pdfs/Krystian_Safjan_resume_priv.pdf">Resume</a>

                <a href="https://www.safjan.com/feeds/all.atom.xml">Atom</a>

                <a href="https://www.safjan.com/feeds/all.rss.xml">RSS</a>

            <div id="search" class="nav-search"></div>
            <button type="button" id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
            </button>
        </nav>

    <article class="single">
        <header>
                
            <p>
                <!-- Posted on: -->
                2025-11-28 


                <br/>
            </p>
            <h1>Working Faster with Git Worktrees and AI-Based Multi-Workflow Development</h1>
            <div class="header-underline"></div>



        </header>




        <div class="article-content">
            <p><em>A practical step-by-step tutorial using Git worktrees, small and large refactorings, and GitHub Copilot.</em></p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before starting, ensure you have:</p>
<ul>
<li><strong>Git 2.5+</strong> (check with <code>git --version</code>)</li>
<li><strong>Python 3.8+</strong> and pip</li>
<li><strong>VS Code</strong> (optional but recommended)</li>
<li><strong>pytest</strong> (<code>pip install pytest</code>)</li>
<li><strong>GitHub Copilot</strong> or another AI coding assistant</li>
<li>Basic familiarity with Git branching and command-line operations</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>There is a moment when a project grows from a single-track workflow into something more complex. The codebase stays small, but you want to try a few big ideas at once. Or you want GitHub Copilot (or any AI coding agent) to attempt two different solutions while you continue working normally. One branch is not enough. Stashes are too messy. Full clones eat time and attention.</p>
<p><a href="https://git-scm.com/docs/git-worktree">Git worktrees</a> solve this elegantly. They let one repository produce several working directories, each on its own branch, all sharing the same underlying store. One directory becomes the human-edited version. Another becomes the AI sandbox. A third holds an alternative AI proposal. You compare the results side by side without the mental reset of switching branches.</p>
<p>This tutorial shows you how to build a multi-workflow setup using a simple Python mini-project. You will run two AI-assisted refactoring tasks: one small and one heavy. You will then evaluate them, compare results, validate correctness, and merge only the parts worth keeping.</p>
<h2 id="starting-point-a-tiny-codebase">Starting Point: A Tiny Codebase</h2>
<h3 id="initial-project-setup">Initial Project Setup</h3>
<p>First, create a fresh repository:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>project
<span class="nb">cd</span><span class="w"> </span>project
git<span class="w"> </span>init
git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>develop
</code></pre></div>

<p>Create a file called <code>stats.py</code> with some simple statistics functions:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># stats.py</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">sorted_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="c1"># Wrong: variance uses mean, not sum of squared values directly</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>Commit this baseline:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>stats.py
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Initial commit with stats module&quot;</span>
</code></pre></div>

<p>There is an obvious bug in <code>variance</code>. The right definition uses squared deviations from the mean.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Correct version of variance (population variance)</span>
<span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>Note: This calculates population variance (dividing by N). Sample variance would use N-1.</p>
<p>This is our baseline. A candidate for small refactoring is the variance fix. A candidate for heavy refactoring is reorganising everything into a class-based structure or splitting the module into multiple files.</p>
<h2 id="step-1-create-a-clean-main-worktree">Step 1: Create a Clean Main Worktree</h2>
<p>You start in the main repository folder, checked out on <code>develop</code>. This is your everyday environment.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>project
git<span class="w"> </span>status
</code></pre></div>

<p>Everything looks normal.</p>
<h2 id="step-2-prepare-worktrees-for-ai-workflows">Step 2: Prepare Worktrees for AI Workflows</h2>
<p>Now create worktrees with new branches for experimentation. The <code>git worktree add</code> command creates both the branch and the working directory in one step:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>add<span class="w"> </span>-b<span class="w"> </span>ai/refactor-small<span class="w"> </span>../refactor-small
git<span class="w"> </span>worktree<span class="w"> </span>add<span class="w"> </span>-b<span class="w"> </span>ai/refactor-heavy<span class="w"> </span>../refactor-heavy
</code></pre></div>

<p>Your directory structure now looks like:</p>
<div class="highlight"><pre><span></span><code>parent-directory/
├── project/           # main worktree (develop branch)
│   └── stats.py
├── refactor-small/    # worktree (ai/refactor-small branch)
│   └── stats.py
└── refactor-heavy/    # worktree (ai/refactor-heavy branch)
    └── stats.py
</code></pre></div>

<p>You now have three directories:</p>
<ul>
<li><code>project/</code> for your normal coding</li>
<li><code>refactor-small/</code> for the AI to attempt precise, localised edits</li>
<li><code>refactor-heavy/</code> for a broad exploration of reorganising the project</li>
</ul>
<p>You can verify existing workflows with:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>list
</code></pre></div>

<p>Each is a full working directory with its own branch and commit history, but the <code>.git</code> data is shared. Switching happens simply by changing directories, not by resetting state.</p>
<h2 id="step-3-run-the-first-workflow-a-small-ai-refactor">Step 3: Run the First Workflow – A Small AI Refactor</h2>
<p>Go into the <code>refactor-small</code> directory and open your IDE.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../refactor-small
code<span class="w"> </span>.
</code></pre></div>

<p>Open <code>stats.py</code> and use <strong>GitHub Copilot Chat</strong> to fix the variance implementation. Exemplary prompt:</p>
<blockquote>
<p>Clean up this file. Fix the variance bug, add type hints, and make error handling more robust. Keep changes minimal.</p>
</blockquote>
<p>Review the AI's suggestions carefully. Accept changes that look correct. The result should be something like:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># stats.py after small refactor</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute average of empty list&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute median of empty list&quot;</span><span class="p">)</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute variance of empty list&quot;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>Commit the result.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>stats.py
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Small refactor: fix variance, add type hints, add basic validation&quot;</span>
</code></pre></div>

<p>Nothing touches the <code>project/</code> folder. No stashes. No switching.</p>
<h2 id="step-4-run-the-heavy-workflow-a-large-scale-ai-refactor">Step 4: Run the Heavy Workflow – A Large-Scale AI Refactor</h2>
<p>Open the second worktree in a <strong>separate VS Code window</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../refactor-heavy
code<span class="w"> </span>.
</code></pre></div>

<p>This time, ask your AI assistant:</p>
<blockquote>
<p>Rewrite this module using an object-oriented structure. Split statistics operations into separate classes if needed. Add validation. Keep the public API clear and ergonomic. Keep the code in the same file do not split into multiple files.</p>
</blockquote>
<p>Expect a much bigger rewrite. Verify changes and commit again:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>stats.py
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Major rewrite: object-oriented Stats class with reorganized structure&quot;</span>
</code></pre></div>

<p>Now you have two valid, complete refactor attempts captured in versioned form, side by side, without any switching friction.</p>
<h2 id="step-5-validate-and-compare-the-results">Step 5: Validate and Compare the Results</h2>
<p>Here is where multi-workflows shine. You can run tests, linters, or performance checks in each directory independently and in parallel.</p>
<p>Back in the main project directory, create a test script:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># test_stats.py (in project/ and refactor-small/)</span>

<span class="kn">from</span> <span class="nn">stats</span> <span class="kn">import</span> <span class="n">average</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">variance</span>

<span class="k">def</span> <span class="nf">test_all</span><span class="p">():</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">average</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">median</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">variance</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">2.0</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_all</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ All tests passed&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Copy this file to both worktrees. For the heavy version, create a different test:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># test_stats.py (in refactor-heavy/)</span>

<span class="kn">from</span> <span class="nn">stats</span> <span class="kn">import</span> <span class="n">Stats</span>

<span class="k">def</span> <span class="nf">test_stats_class</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">average</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">median</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">2.0</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_stats_class</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All tests passed&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Run tests separately in each worktree:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>project
python<span class="w"> </span>test_stats.py
<span class="c1"># Output: All tests passed</span>

<span class="nb">cd</span><span class="w"> </span>../refactor-small
python<span class="w"> </span>test_stats.py
<span class="c1"># Output: All tests passed</span>

<span class="nb">cd</span><span class="w"> </span>../refactor-heavy
python<span class="w"> </span>test_stats.py
<span class="c1"># Output: All tests passed</span>
</code></pre></div>

<p>You get independent validation. If the heavy refactor has bugs, you know immediately without polluting the main line of work.</p>
<h2 id="step-6-decide-what-to-merge">Step 6: Decide What to Merge</h2>
<p>You now have three evolving branches:</p>
<ul>
<li><code>develop</code> with your original code</li>
<li><code>ai/refactor-small</code> with a careful, stable refactor</li>
<li><code>ai/refactor-heavy</code> with a more ambitious rewrite</li>
</ul>
<p>Decision time usually involves:</p>
<ul>
<li>Code clarity</li>
<li>Compatibility with existing imports</li>
<li>Test coverage</li>
<li>Future extensibility</li>
<li>Performance</li>
</ul>
<p>For many teams, the small refactor becomes a straightforward merge:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../project<span class="w">  </span><span class="c1"># Return to main worktree</span>
git<span class="w"> </span>switch<span class="w"> </span>develop
git<span class="w"> </span>merge<span class="w"> </span>ai/refactor-small
<span class="c1"># Output: Fast-forward or Merge made by the &#39;recursive&#39; strategy.</span>
</code></pre></div>

<p>After merging, run tests again to ensure everything works:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>test_stats.py
</code></pre></div>

<p>The heavy refactor might need additional time, iteration, or might stay as a long-running branch until more confidence is built. You can keep that worktree around for continued experimentation.</p>
<h2 id="step-7-cleaning-up">Step 7: Cleaning Up</h2>
<p>After merging what you want, remove worktrees you no longer need.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>remove<span class="w"> </span>../refactor-small
</code></pre></div>

<p>For branches you want to keep but not actively work on:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Archive the heavy refactor branch for future reference</span>
git<span class="w"> </span>branch<span class="w"> </span>--move<span class="w"> </span>ai/refactor-heavy<span class="w"> </span>archive/refactor-heavy-2025-12
git<span class="w"> </span>worktree<span class="w"> </span>remove<span class="w"> </span>../refactor-heavy
</code></pre></div>

<p>Or delete the branch entirely if you don't need it:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>remove<span class="w"> </span>../refactor-heavy
git<span class="w"> </span>branch<span class="w"> </span>-D<span class="w"> </span>ai/refactor-heavy
</code></pre></div>

<p>If Git complains the directory still exists, delete it manually and run:</p>
<div class="highlight"><pre><span></span><code>rm<span class="w"> </span>-rf<span class="w"> </span>../refactor-heavy
git<span class="w"> </span>worktree<span class="w"> </span>prune
</code></pre></div>

<p>List remaining worktrees:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>list
</code></pre></div>

<h2 id="why-this-workflow-works-so-well">Why This Workflow Works So Well</h2>
<p>This approach removes the friction of experimental coding. AI tools prefer entire files or folders as context, and they sometimes rewrite aggressively rather than patch small areas. Worktrees give them dedicated sandboxes, and they give you mental clarity: each branch corresponds to a purpose. You can compare outputs by simply opening two folders side by side instead of juggling switching commands that reset your IDE state.</p>
<p>Worktrees also encourage discipline. You evaluate AI-generated changes deliberately, not impulsively. You treat each branch as a self-contained proposal. This makes working with powerful automated tools safer, faster, and easier to reason about.</p>
<p>The biggest advantage is velocity without chaos: several workflows move forward independently, but none interfere with your main development branch. You keep the codebase clean, and you can run experiments all day without ever fearing that an agent will overwrite something you care about.</p>
<p>If you use AI in your everyday coding, this structure should become second nature. It transforms the way you evaluate ideas, especially when dealing with both small fixes and large rewrites.</p>
<h2 id="troubleshooting-common-issues">Troubleshooting Common Issues</h2>
<p><strong>Problem</strong>: "fatal: 'ai/refactor-small' is already checked out at..."<br>
<strong>Solution</strong>: You can't check out the same branch in multiple worktrees. Use different branch names.</p>
<p><strong>Problem</strong>: Changes appear in the wrong worktree<br>
<strong>Solution</strong>: Check which directory you're in with <code>pwd</code>. Verify the branch with <code>git branch --show-current</code>.</p>
<p><strong>Problem</strong>: VS Code commits to wrong branch<br>
<strong>Solution</strong>: Always open the worktree directory as the workspace root, not a parent folder. Check the branch indicator in the bottom-left corner.</p>
<p><strong>Problem</strong>: Tests fail after AI refactor<br>
<strong>Solution</strong>: Review AI changes line-by-line. AI tools sometimes introduce subtle bugs. Use <code>git diff</code> to see exactly what changed.</p>
<p><strong>Problem</strong>: Can't delete worktree<br>
<strong>Solution</strong>: Close all editors and terminals in that worktree, then use <code>git worktree remove --force</code> if needed.</p>
<h2 id="extras">Extras</h2>
<div class="highlight"><pre><span></span><code>###<span class="w"> </span><span class="nv">Using</span><span class="w"> </span><span class="nv">VS</span><span class="w"> </span><span class="nv">Code</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">Multiple</span><span class="w"> </span><span class="nv">Worktrees</span><span class="w"> </span><span class="nv">Without</span><span class="w"> </span><span class="nv">Losing</span><span class="w"> </span><span class="nv">Your</span><span class="w"> </span><span class="nv">Mind</span>

<span class="nv">Now</span><span class="w"> </span><span class="nv">comes</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">tricky</span><span class="w"> </span><span class="nv">part</span>.<span class="w"> </span><span class="nv">Developers</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">confused</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">multi</span><span class="o">-</span><span class="nv">worktree</span><span class="w"> </span><span class="nv">setups</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">because</span><span class="w"> </span><span class="nv">Git</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">hard</span>,<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">because</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">editor</span><span class="w"> </span><span class="nv">happily</span><span class="w"> </span><span class="nv">opens</span><span class="w"> </span><span class="nv">whatever</span><span class="w"> </span><span class="nv">folder</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">people</span><span class="w"> </span><span class="nv">forget</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">workflow</span><span class="w"> </span><span class="nv">they</span>’<span class="nv">re</span><span class="w"> </span><span class="nv">editing</span>.<span class="w"> </span><span class="nv">One</span><span class="w"> </span><span class="nv">tiny</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">wrong</span><span class="w"> </span><span class="nv">branch</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">careful</span><span class="w"> </span><span class="nv">separation</span><span class="w"> </span><span class="nv">collapses</span>.

<span class="nv">The</span><span class="w"> </span><span class="nv">easiest</span><span class="w"> </span><span class="nv">way</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">stay</span><span class="w"> </span><span class="nv">sane</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">open</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">worktree</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">separate</span><span class="w"> </span><span class="nv">VS</span><span class="w"> </span><span class="nv">Code</span><span class="w"> </span><span class="nv">window</span>.

<span class="k">If</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">open</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">root</span><span class="w"> </span><span class="nv">project</span><span class="w"> </span><span class="nv">folder</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nv">navigating</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span>`.<span class="nv">worktrees</span><span class="o">/</span>...`,<span class="w"> </span><span class="nv">you</span>’<span class="nv">re</span><span class="w"> </span><span class="nv">setting</span><span class="w"> </span><span class="nv">yourself</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">mistakes</span>.<span class="w"> </span><span class="nv">Instead</span>,<span class="w"> </span><span class="nv">open</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">worktree</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="nv">itself</span>:

```<span class="nv">bash</span>
<span class="nv">code</span><span class="w"> </span>..<span class="o">/</span><span class="nv">project</span>
<span class="nv">code</span><span class="w"> </span>..<span class="o">/</span><span class="nv">refactor</span><span class="o">-</span><span class="nv">small</span>
</code></pre></div>

<p>This gives each workflow its own VS Code instance, with its own branch badge in the bottom-left status bar. You never want both instances to point at the same folder tree.</p>
<p>The moment you enter a file in the wrong window, you’ll see the branch indicator complaining. Git worktree integration in VS Code is surprisingly stable as long as each window corresponds to just one worktree.</p>
        </div>


        <div class="article-tags">
            <span class="tags-label">Tags:</span>
                <a href="https://www.safjan.com/tag/git-worktrees-ai-coding-refactoring-workflows-vscode-productivity/" class="article-tag">git, worktrees, ai-coding, refactoring, workflows, vscode, productivity</a>
        </div>











    </article>

    <footer>
<p>
  &copy; 2026 Krystian Safjan - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>    </footer>
</main>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Krystian Safjan's Blog",
  "url": "https://www.safjan.com",
"image": "/images/profile_new.jpg",  "description": ""
}
</script>


<script src="https://www.safjan.com/pagefind/pagefind-ui.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', function() {
        new PagefindUI({
            element: "#search",
            showSubResults: false,
            showImages: false,
            basePath: "https://www.safjan.com/pagefind/"
        });
    });
</script>

<script src="https://www.safjan.com/theme/js/theme-switcher.js"></script>
</body>
</html>