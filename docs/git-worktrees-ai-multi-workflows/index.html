
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"/>
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
              rel="stylesheet">

        <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/stylesheet/style.min.css">



        <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              href="https://www.safjan.com/theme/pygments/github.min.css">


    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/solid.css">

        <link rel="stylesheet" type="text/css"
              href="https://www.safjan.com/styles/custom.css">

        <link href="https://www.safjan.com/feeds/all.atom.xml?utm_source=rss&utm_medium=feed&utm_campaign=rss-feed" type="application/atom+xml" rel="alternate"
              title="Krystian Safjan's Blog Atom">

        <link href="https://www.safjan.com/feeds/all.rss.xml?utm_source=rss&utm_medium=feed&utm_campaign=rss-feed" type="application/rss+xml" rel="alternate"
              title="Krystian Safjan's Blog RSS">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RM2PKDCCYM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RM2PKDCCYM');
</script>
<!-- End of Google tag (gtag.js) -->



    <meta name="author" content="Krystian Safjan" />
    <meta name="description" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate experiments, compare results, and speed up refactoring work with agents and Copilot." />
    <meta name="keywords" content="git, worktrees, ai-coding, refactoring, workflows, vscode, productivity">
    <meta expr:content="2025-11-28 00:00:00+01:00" itemprop='datePublished' />
    <meta expr:content="2025-11-28 00:00:00+01:00" itemprop='dateModified' />
    <meta property="article:modified_time" content="2025-11-28 00:00:00+01:00" />
    <meta property="article:published_time" content="2025-11-28 00:00:00+01:00" />
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Working Faster with Git Worktrees and AI-Based Multi-Workflow Development",
  "datePublished": "2025-11-28 00:00:00+01:00",
  "dateModified": "2025-11-28 00:00:00+01:00"
}
    </script>
  <meta property="og:site_name" content="Krystian Safjan's Blog"/>
  <meta property="og:title" content="Working Faster with Git Worktrees and AI-Based Multi-Workflow Development"/>
  <meta property="og:description" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate experiments, compare results, and speed up refactoring work with agents and Copilot."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://www.safjan.com/git-worktrees-ai-multi-workflows/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2025-11-28 00:00:00+01:00"/>
  <meta property="article:modified_time" content="2025-11-28 00:00:00+01:00"/>
  <meta property="article:author" content="https://www.safjan.com/author/krystian-safjan/">
  <meta property="article:section" content="note"/>
  <meta property="article:tag" content="git"/>
  <meta property="article:tag" content="worktrees"/>
  <meta property="article:tag" content="ai-coding"/>
  <meta property="article:tag" content="refactoring"/>
  <meta property="article:tag" content="workflows"/>
  <meta property="article:tag" content="vscode"/>
  <meta property="article:tag" content="productivity"/>
  <meta property="og:image" content="/images/profile_new.jpg">

    <meta name="twitter:card" content="summary"/>

    <meta property="twitter:image" content="/images/profile_new.jpg">


    <meta name="twitter:site" content="@izikeros"/>
    <meta name="twitter:creator" content="@izikeros"/>
    <meta name="twitter:description" content="A practical, hands-on guide to turning a single codebase into a multi-workflow environment using Git worktrees, VS Code, and AI coding assistants. The tutorial shows how to isolate..."/>
    <meta name="twitter:title" content="Working Faster with Git Worktrees and AI-Based Multi-Workflow Development"/>

    <title>Working Faster with Git Worktrees and AI-Based Multi-Workflow Development</title>



<!-- Google Automatic Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9767732578835199"
     crossorigin="anonymous"></script>
<!-- End of Google Automatic Ads -->


</head>
<body class="light-theme">
<aside>
    <div>
        <a href="https://www.safjan.com/">
                <img src="/images/profile_new.jpg" alt="Krystian Safjan's Blog" title="Krystian Safjan's Blog" width="140" height="140">
        </a>

        <h1>
            <a href="https://www.safjan.com/">Krystian Safjan's Blog</a>
        </h1>

<p>Data Scientist | Researcher | Team Leader<br><br> working at Ernst &amp; Young and writing about <a href="/category/machine-learning.html">Data Science and Visualization</a>, on <a href="/category/machine-learning.html">Machine Learning, Deep Learning</a> and <a href="/tag/nlp/">NLP</a>. There are also some <a href="/category/howto.html">howto</a> posts on tools and workflows.</p>


        <ul class="social">
                <li>
                    <a  class="sc-linkedin" href="https://pl.linkedin.com/in/krystiansafjan"
                       target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/izikeros"
                       target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-envelope" href="mailto:ksafjan@gmail.com"
                       target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-graduation-cap" href="https://scholar.google.pl/citations?user=UlNJgMoAAAAJ"
                       target="_blank">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-rss" href="/feeds/all.rss.xml"
                       target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>

<style>
    .button {
        background-color: yellow;
        color: black;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 20px;
    }

    .center {
        text-align: center;
    }

    .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }

    .left-col {
    }

    .right-col {
    }

    .image {
        border-radius: 0;
        width: 100%;
    }

    .book-list {
        padding-top:0;
        padding-bottom: 0;
        text-align:left;
        box-sizing: border-box;
        display: block;
        list-style-image: url(/images/shortcode-tick.webp);
        margin-block-start: 1em;
        margin-block-end: 1em;
        margin-inline-start:0;
        margin-inline-end:0;
        padding-inline-start:40px;
    }

    .book-list li {
        font-weight: bold;
    }

    @media (max-width: 600px) {
        .container {
            grid-template-columns: 1fr;
        }
    }

</style>
<div class="container">
    <div class="left-col">
        <a href="https://ksafjanuser.gumroad.com/l/mlops">
            <img src="/images/mlop_interview_book_cover_3D_300px.jpg" class="image" alt="Interview Book Cover">
        </a>

        <div class="center">
            <a href="https://ksafjanuser.gumroad.com/l/mlops">
                <button class="button">Get for $2.99</button>
            </a>
        </div>
    </div>
    <div class="right-col">
        <div>
            <ul class="book-list">
                <li>PDF, ePUB, mobi format ebook, no DRM</li>
                <li>50 questions and answers</li>
                <li>Stories from real projects</li>
                <li>92 multiple choice quiz questions</li>
                <li>80 pages</li>
            </ul>
        </div>
    </div>
</div>
</aside>
<main>

        <nav>
            <a href="https://www.safjan.com/">Home</a>

                <a href="/archives.html">Articles</a>
                <a href="/til.html">Notes</a>
                <a href="/categories.html">Categories</a>
                <a href="/pdfs/Krystian_Safjan_resume_priv.pdf">Resume</a>

                <a href="https://www.safjan.com/feeds/all.atom.xml">Atom</a>

                <a href="https://www.safjan.com/feeds/all.rss.xml">RSS</a>
        </nav>

    <article class="single">
        <header>
                
            <p>
                <!-- Posted on: -->
                2025-11-28 
                    <span id="post-share-links">
                        &nbsp;&nbsp;&nbsp;Share on:
                        <a href="https://twitter.com/intent/tweet?text=Working%20Faster%20with%20Git%20Worktrees%20and%20AI-Based%20Multi-Workflow%20Development&url=https%3A//www.safjan.com/git-worktrees-ai-multi-workflows/&via=izikeros&hashtags=git,worktrees,ai-coding,refactoring,workflows,vscode,productivity"
                           target="_blank"
                           title="Share on Twitter">Twitter</a>
                        |
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//www.safjan.com/git-worktrees-ai-multi-workflows/"
                           target="_blank"
                           title="Share on Facebook">Facebook</a>
                        |
                        <a href="https://news.ycombinator.com/submitlink?t=Working%20Faster%20with%20Git%20Worktrees%20and%20AI-Based%20Multi-Workflow%20Development&u=https%3A//www.safjan.com/git-worktrees-ai-multi-workflows/"
                           target="_blank"
                           title="Share on HackerNews">HackerNews</a>
                        |
                        <a href="https://www.reddit.com/submit?url=https%3A//www.safjan.com/git-worktrees-ai-multi-workflows/&title=Working%20Faster%20with%20Git%20Worktrees%20and%20AI-Based%20Multi-Workflow%20Development"
                           target="_blank"
                           title="Share via Reddit">Reddit</a>
                    </span>
                <br />
            </p>
            <h1 id="git-worktrees-ai-multi-workflows">Working Faster with Git Worktrees and AI-Based Multi-Workflow Development</h1>
            <div class="header-underline"></div>
        </header>
        <div><p><em>A practical step-by-step tutorial using Git worktrees, small and large refactorings, and GitHub Copilot.</em></p>
<h2>Introduction</h2>
<p>There is a moment when a project grows from a single-track workflow into something more complex. The codebase stays small, but you want to try a few big ideas at once. Or you want GitHub Copilot (or any AI coding agent) to attempt two different solutions while you continue working normally. One branch is not enough. Stashes are too messy. Full clones eat time and attention.</p>
<p><a href="https://git-scm.com/docs/git-worktree">Git worktrees</a> solve this elegantly. They let one repository produce several working directories, each on its own branch, all sharing the same underlying store. One directory becomes the human-edited version. Another becomes the AI sandbox. A third holds an alternative AI proposal. You compare the results side by side without the mental reset of switching branches.</p>
<p>This tutorial shows you how to build a multi-workflow setup using a simple Python mini-project. You will run two AI-assisted refactoring tasks: one small and one heavy. You will then evaluate them, compare results, validate correctness, and merge only the parts worth keeping.</p>
<h2>Starting Point: A Tiny Codebase</h2>
<p>Assume we begin with a very small project containing one module called <code>stats.py</code>. It calculates a few simple statistics.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># stats.py</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">sorted_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="c1"># Wrong: variance uses mean, not sum of squared values directly</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>There is an obvious bug in <code>variance</code>. The right definition uses squared deviations from the mean.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Correct version of variance</span>
<span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>This is our baseline. A candidate for small refactoring is the variance fix. A candidate for heavy refactoring is reorganising everything into a class-based structure or splitting the module into multiple files.</p>
<h2>Step 1: Create a Clean Main Worktree</h2>
<p>You start in the main repository folder, checked out on <code>develop</code>. This is your everyday environment.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>project
git<span class="w"> </span>status
</code></pre></div>

<p>Everything looks normal.</p>
<h2>Step 2: Prepare Worktrees for AI Workflows</h2>
<p>Now create a branch exclusively for the small refactoring, and another branch to explore a heavy rewrite.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>add<span class="w"> </span>../refactor-small<span class="w"> </span>ai/refactor-small
git<span class="w"> </span>worktree<span class="w"> </span>add<span class="w"> </span>../refactor-heavy<span class="w"> </span>ai/refactor-heavy
</code></pre></div>

<p>You now have three directories:</p>
<ul>
<li><code>project/</code> for your normal coding</li>
<li><code>refactor-small/</code> for the AI to attempt precise, localised edits</li>
<li><code>refactor-heavy/</code> for a broad exploration of reorganising the project</li>
</ul>
<p>Each is a full working directory with its own branch and commit history, but the <code>.git</code> data is shared. Switching happens simply by changing directories, not by resetting state.</p>
<h2>Step 3: Run the First Workflow – A Small AI Refactor</h2>
<p>Go into the <code>refactor-small</code> directory and open your IDE.</p>
<p>Ask Copilot (or another model) to fix the variance implementation and streamline the small functions. Something like:</p>
<blockquote>
<p>Clean up this file. Fix the variance bug, add type hints, and make error handling more robust. Keep changes minimal.</p>
</blockquote>
<p>Copilot should produce something along these lines:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># stats.py after small refactor</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute average of empty list&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute median of empty list&quot;</span><span class="p">)</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute variance of empty list&quot;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>Commit the result.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>stats.py
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Small refactor: fix variance, add type hints, add basic validation&quot;</span>
</code></pre></div>

<p>Nothing touches the <code>project/</code> folder. No stashes. No switching.</p>
<h2>Step 4: Run the Heavy Workflow – A Large-Scale AI Refactor</h2>
<p>Open the second worktree.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../refactor-heavy
</code></pre></div>

<p>This time, ask your AI assistant:</p>
<blockquote>
<p>Rewrite this module using an object-oriented structure. Split statistics operations into separate classes if needed. Add validation. Keep the public API clear and ergonomic.</p>
</blockquote>
<p>Expect a much bigger rewrite. Copilot might produce something like this:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># stats/metrics.py after heavy refactor</span>

<span class="k">class</span> <span class="nc">Stats</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Values cannot be empty&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sorted_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">sorted_values</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

<p>This version creates a directory layout like:</p>
<div class="highlight"><pre><span></span><code>stats/
    __init__.py
    metrics.py
</code></pre></div>

<p>Commit again:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Major rewrite: object-oriented Stats class with reorganized structure&quot;</span>
</code></pre></div>

<p>Now you have two valid, complete refactor attempts captured in versioned form, side by side, without any switching friction.</p>
<h2>Step 5: Validate and Compare the Results</h2>
<p>Here is where multi-workflows shine. You can run tests, linters, or performance checks in each directory independently and in parallel.</p>
<p>Back in the main project, create a quick test script:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># test_stats.py</span>

<span class="kn">from</span> <span class="nn">stats</span> <span class="kn">import</span> <span class="n">average</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">variance</span>

<span class="k">def</span> <span class="nf">test_all</span><span class="p">():</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">average</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">median</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">variance</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">2.0</span>
</code></pre></div>

<p>For the heavy version, you might need a different import:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># test_stats_heavy.py</span>

<span class="kn">from</span> <span class="nn">stats.metrics</span> <span class="kn">import</span> <span class="n">Stats</span>

<span class="k">def</span> <span class="nf">test_stats_class</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">average</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">median</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">2.0</span>
</code></pre></div>

<p>Run tests separately in each worktree:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>project
pytest<span class="w"> </span>-q

<span class="nb">cd</span><span class="w"> </span>../refactor-small
pytest<span class="w"> </span>-q

<span class="nb">cd</span><span class="w"> </span>../refactor-heavy
pytest<span class="w"> </span>-q
</code></pre></div>

<p>You get independent validation. If the heavy refactor has bugs, you know immediately without polluting the main line of work.</p>
<h2>Step 6: Decide What to Merge</h2>
<p>You now have three evolving branches:</p>
<ul>
<li>
<p><code>develop</code> with your original code</p>
</li>
<li>
<p><code>ai/refactor-small</code> with a careful, stable refactor</p>
</li>
<li>
<p><code>ai/refactor-heavy</code> with a more ambitious rewrite</p>
</li>
</ul>
<p>Decision time usually involves:</p>
<ul>
<li>
<p>Code clarity</p>
</li>
<li>
<p>Compatibility with existing imports</p>
</li>
<li>
<p>Test coverage</p>
</li>
<li>
<p>Future extensibility</p>
</li>
<li>
<p>Performance</p>
</li>
</ul>
<p>For many teams, the small refactor becomes a straightforward merge:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>switch<span class="w"> </span>develop
git<span class="w"> </span>merge<span class="w"> </span>ai/refactor-small
</code></pre></div>

<p>The heavy refactor might need additional time, iteration, or might stay as a long-running branch until more confidence is built.</p>
<h2>Step 7: Cleaning Up</h2>
<p>After merging what you want, remove worktrees you no longer need.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>remove<span class="w"> </span>../refactor-small
git<span class="w"> </span>worktree<span class="w"> </span>remove<span class="w"> </span>../refactor-heavy
</code></pre></div>

<p>If Git complains the directory still exists, delete it manually and run:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>worktree<span class="w"> </span>prune
</code></pre></div>

<h2>Why This Workflow Works So Well</h2>
<p>This approach removes the friction of experimental coding. AI tools prefer entire files or folders as context, and they sometimes rewrite aggressively rather than patch small areas. Worktrees give them dedicated sandboxes, and they give you mental clarity: each branch corresponds to a purpose. You can compare outputs by simply opening two folders side by side instead of juggling switching commands that reset your IDE state.</p>
<p>Worktrees also encourage discipline. You evaluate AI-generated changes deliberately, not impulsively. You treat each branch as a self-contained proposal. This makes working with powerful automated tools safer, faster, and easier to reason about.</p>
<p>The biggest advantage is velocity without chaos: several workflows move forward independently, but none interfere with your main development branch. You keep the codebase clean, and you can run experiments all day without ever fearing that an agent will overwrite something you care about.</p>
<p>If you use AI in your everyday coding, this structure should become second nature. It transforms the way you evaluate ideas, especially when dealing with both small fixes and large rewrites.</p>
<h2>Extras</h2>
<h3>Comparing Workflows with <code>git diff --no-index</code> and Practical Multi-Workflow Tips</h3>
<p>At some point you want to know which variant actually performed better. Maybe the baseline is cleaner. Maybe the Copilot heavy-refactor got overly creative. A simple trick is to compare two worktrees without committing anything. This is where <code>git diff --no-index</code> feels almost unfair because it ignores Git’s object database and simply diffs two directories. Perfect for AI-driven experimentation.</p>
<p>You run this from anywhere, and Git treats both directories like normal folders.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>diff<span class="w"> </span>--no-index<span class="w"> </span>../baseline<span class="w"> </span>../agent-refactor
</code></pre></div>

<p>If you are inside <code>agent-refactor</code>, the paths look like this:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>diff<span class="w"> </span>--no-index<span class="w"> </span>.<span class="w"> </span>../baseline
</code></pre></div>

<p>This gives you a raw diff across files regardless of whether they’re tracked in the same repo. The output is blunt, noisy, and brutally honest, which is exactly what you want when checking what an AI agent really did. When the diff is unreadable, that’s often a hint that the refactor mutated too much at once. In those cases, I sometimes do a narrower diff:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>diff<span class="w"> </span>--no-index<span class="w"> </span>../baseline/path/to/module.py<span class="w"> </span>path/to/module.py
</code></pre></div>

<p>or even a directory-level diff to check how wide the blast radius went:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>diff<span class="w"> </span>--no-index<span class="w"> </span>../baseline/src<span class="w"> </span>../agent-refactor/src
</code></pre></div>

<h3>Using VS Code with Multiple Worktrees Without Losing Your Mind</h3>
<p>Now comes the tricky part. Developers get confused in multi-worktree setups not because Git is hard, but because the editor happily opens whatever folder you point at and then people forget which workflow they’re editing. One tiny commit into the wrong branch and your careful separation collapses.</p>
<p>The easiest way to stay sane is to open each worktree as a separate VS Code window.</p>
<p>If you open the root project folder and start navigating into <code>.worktrees/...</code>, you’re setting yourself up for mistakes. Instead, open the worktree directory itself:</p>
<div class="highlight"><pre><span></span><code>code<span class="w"> </span>../baseline
code<span class="w"> </span>../agent-refactor
</code></pre></div>

<p>This gives each workflow its own VS Code instance, with its own branch badge in the bottom-left status bar. You never want both instances to point at the same folder tree.</p>
<p>The moment you enter a file in the wrong window, you’ll see the branch indicator complaining. Git worktree integration in VS Code is surprisingly stable as long as each window corresponds to just one worktree.</p>
<h3>Committing From the VS Code UI to the Correct Branch</h3>
<p>Another easy place to make mistakes is committing. VS Code’s SCM panel will happily stage and commit changes, but only if the workspace folder is the actual worktree root.</p>
<p>If the root folder in your VS Code window is <code>../agent-refactor</code>, then the SCM panel will commit to the branch connected to that worktree. This is the safe path.</p>
<p>If, however, you open a parent directory and the worktree folder is nested inside, VS Code gets confused because it sees multiple <code>.git</code> locations. In that setup committing is dangerous. That’s the exact scenario where you accidentally commit to the wrong branch.</p>
<p>So the rule of thumb is very blunt: always open the worktree root as your workspace root, never a parent folder.</p>
<p>One more subtle point. When you use the VS Code "Source Control" view, it shows untracked files, staged files, everything. But the "branch" name in the status bar is the ultimate truth. If your window says "main" and you think you're inside an experimental worktree, stop immediately and re-open the correct folder.</p>
<h3>How to Inspect Which Workflow You Are In</h3>
<p>There are several quick signals you can build into your workflow.</p>
<p>You can add a small file at the root of each worktree:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WORKFLOW=baseline&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>workflow.tag
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WORKFLOW=agent-refactor&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>workflow.tag
</code></pre></div>

<p>This is not tracked by Git if you put it in <code>.git/info/exclude</code>. When this file is present, VS Code’s quick search reveals it instantly. The visible presence of the tag helps when you jump between windows.</p>
<p>You can also put a different color theme per workflow window. For example, baseline = light theme, refactor = dark theme. It sounds silly, but it prevents accidental edits.</p>
<p>Another simple method is to customize the terminal prompt inside each window:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># In baseline worktree</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[baseline] </span><span class="nv">$PS1</span><span class="s2">&quot;</span>
<span class="c1"># In agent-refactor</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[refactor] </span><span class="nv">$PS1</span><span class="s2">&quot;</span>
</code></pre></div>

<p>Now your integrated terminal reminds you where you are every time you run a command.</p>
<h3>A Section for Power Users</h3>
<p>AI-assisted multi-workflows shine even more when you enable some advanced tricks.</p>
<ul>
<li>
<p>Run benchmark scripts separately in each worktree. A fast benchmark runner in <code>baseline</code> and then the same in <code>agent-refactor</code> will give you meaningful signals about performance regressions.</p>
</li>
<li>
<p>Automate comparison with a one-liner script:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
git<span class="w"> </span>diff<span class="w"> </span>--no-index<span class="w"> </span>../baseline<span class="w"> </span>../agent-refactor<span class="w"> </span><span class="p">|</span><span class="w"> </span>code<span class="w"> </span>-
</code></pre></div>

<p>This opens a diff buffer in VS Code directly. It feels like magic.</p>
<ul>
<li>
<p>You can use the GitLens extension. It understands worktrees and shows you exactly which branch belongs to which folder.</p>
</li>
<li>
<p>Test AI agents in parallel by launching each agent process pointing at a different worktree. This isolates their writes and makes their behaviors easier to compare. When the AI agent misbehaves, simply drop that worktree.</p>
</li>
</ul></div>
        <div class="tag-cloud">
            <p>
                    <br />
                    <br />
                    Tags:&nbsp;
<a href="https://www.safjan.com/tag/git/">git</a><a href="https://www.safjan.com/tag/worktrees/">worktrees</a><a href="https://www.safjan.com/tag/ai-coding/">ai-coding</a><a href="https://www.safjan.com/tag/refactoring/">refactoring</a><a href="https://www.safjan.com/tag/workflows/">workflows</a><a href="https://www.safjan.com/tag/vscode/">vscode</a><a href="https://www.safjan.com/tag/productivity/">productivity</a>            </p>
        </div>
            <div class="related-posts">
                <h4>You might enjoy</h4>
                <ul class="related-posts">
                        <li>
                            <a href="https://www.safjan.com/git-worktrees-for-ai-coding/">Using Git Worktrees as Clean Rooms for AI-Assisted Coding</a>
                        </li>
                        <li>
                            <a href="https://www.safjan.com/time-tracking-apps/">Time Tracking Apps</a>
                        </li>
                        <li>
                            <a href="https://www.safjan.com/git-checkout-orphan-gh-pages-performance-results/">Keeping performance results in a separate Git branch using `git checkout --orphan`</a>
                        </li>
                        <li>
                            <a href="https://www.safjan.com/github-permission-to-repogit-denied-to-user/">GitHub - Troubleshooting 'Permission to repo.git denied to user'</a>
                        </li>
                        <li>
                            <a href="https://www.safjan.com/python-project-with-Poetry-add-poetry-lock-to-the-git-repo-or-ignore-it/">In the Python project made with Poetry shall I add poetry.lock to the git repo or ignore it?</a>
                        </li>
                </ul>
            </div>
    </article>

    <footer>
<p>
  &copy; 2025 Krystian Safjan - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
</main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Krystian Safjan's Blog ",
  "url" : "https://www.safjan.com",
  "image": "/images/profile_new.jpg",
  "description": ""
}
</script>

</body>
</html>