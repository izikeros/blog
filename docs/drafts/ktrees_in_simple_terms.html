
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"/>
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
              rel="stylesheet">

        <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/stylesheet/style.min.css">



        <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              href="https://www.safjan.com/theme/pygments/github.min.css">



    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/solid.css">

        <link rel="stylesheet" type="text/css"
              href="https://www.safjan.com/styles/custom.css">

        <link href="https://www.safjan.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Krystian Safjan's Blog Atom">

        <link href="https://www.safjan.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Krystian Safjan's Blog RSS">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117080232-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117080232-1');
</script>
<!-- End of Google tag (gtag.js) -->



    <meta name="author" content="Krystian Safjan"/>
    <meta name="description" content="Discover the power of k-d trees for multi-dimensional data organization and search. Learn how to efficiently find nearest neighbors and points within a given range."/>
    <meta name="keywords" content="k-d-tree, binary-search-tree, multi-dimensional-space, computer-graphics, image-processing, machine-learning, data-structure, search-algorithm, nearest-neighbor-search, range-search, ball-trees, cover-trees, curse-of-dimensionality, efficient-data-organization">
    <meta expr:content="2023-03-02 00:00:00+01:00" itemprop='datePublished'/>
    <meta expr:content="2023-03-02 00:00:00+01:00" itemprop='dateModified'/>
    <meta property="article:modified_time" content="2023-03-02 00:00:00+01:00"/>
    <meta property="article:published_time" content="2023-03-02 00:00:00+01:00"/>
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "K-D Trees explained in simple terms",
  "datePublished": "2023-03-02 00:00:00+01:00",
  "dateModified": "2023-03-02 00:00:00+01:00"
}








    </script>



  <meta property="og:site_name" content="Krystian Safjan's Blog"/>
  <meta property="og:title" content="K-D Trees explained in simple terms"/>
  <meta property="og:description" content="Discover the power of k-d trees for multi-dimensional data organization and search. Learn how to efficiently find nearest neighbors and points within a given range."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://www.safjan.com/drafts/ktrees_in_simple_terms.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-03-02 00:00:00+01:00"/>
  <meta property="article:modified_time" content="2023-03-02 00:00:00+01:00"/>
  <meta property="article:author" content="https://www.safjan.com/author/krystian-safjan/">
  <meta property="article:section" content="Machine Learning"/>
  <meta property="article:tag" content="k-d-tree"/>
  <meta property="article:tag" content="binary-search-tree"/>
  <meta property="article:tag" content="multi-dimensional-space"/>
  <meta property="article:tag" content="computer-graphics"/>
  <meta property="article:tag" content="image-processing"/>
  <meta property="article:tag" content="machine-learning"/>
  <meta property="article:tag" content="data-structure"/>
  <meta property="article:tag" content="search-algorithm"/>
  <meta property="article:tag" content="nearest-neighbor-search"/>
  <meta property="article:tag" content="range-search"/>
  <meta property="article:tag" content="ball-trees"/>
  <meta property="article:tag" content="cover-trees"/>
  <meta property="article:tag" content="curse-of-dimensionality"/>
  <meta property="article:tag" content="efficient-data-organization"/>
  <meta property="og:image" content="https://www.safjan.com//images/head/abstract_1.jpg">

    <meta name="twitter:card" content="summary"/>
    <meta property="twitter:image" content="https://www.safjan.com//images/head/abstract_1.jpg">

    <meta name="twitter:label1" content="Est. reading time"/>
    <meta name="twitter:data1" content="4 min."/>
    <meta name="twitter:site" content="@izikeros"/>
    <meta name="twitter:description" content="<p>Discover the power of k-d trees for multi-dimensional data organization and search. Learn how to efficiently find nearest neighbors and points within a given range.</p>"/>
    <meta name="twitter:title" content="K-D Trees explained in simple terms"/>


    <title>    K-D Trees explained in simple terms
</title>


<!-- Google Automatic Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9767732578835199"
     crossorigin="anonymous"></script>
<!-- End of Google Automatic Ads -->


</head>
<body class="light-theme">
<aside>
    <div>
        <a href="https://www.safjan.com/">
                <img src="/images/profile_new.jpg" alt="Krystian Safjan's Blog" title="Krystian Safjan's Blog" width="140" height="140">
        </a>

        <h1>
            <a href="https://www.safjan.com/">Krystian Safjan's Blog</a>
        </h1>

<p>Data Scientist | Researcher | Team Leader<br><br> working at Ernst &amp; Young and writing about <a href="/category/machine-learning.html">Data Science and Visualization</a>, on <a href="/category/machine-learning.html">Machine Learning, Deep Learning</a> and <a href="/tag/nlp/">NLP</a>. There are also some  <a href="/category/howto.html">howto</a> posts on tools and workflows.</p>




        <ul class="social">
                <li>
                    <a  class="sc-linkedin" href="https://pl.linkedin.com/in/krystiansafjan"
                       target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/izikeros"
                       target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-envelope" href="mailto:ksafjan@gmail.com"
                       target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-graduation-cap" href="https://scholar.google.pl/citations?user=UlNJgMoAAAAJ"
                       target="_blank">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-rss" href="/feeds/all.rss.xml"
                       target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>

<style>
    .button {
        background-color: yellow;
        color: black;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 20px;
    }

    .center {
        text-align: center;
    }

    .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }

    .left-col {
    }

    .right-col {
    }

    .image {
        border-radius: 0;
        width: 100%;
    }

    .book-list {
        padding-top:0;
        padding-bottom: 0;
        text-align:left;
        box-sizing: border-box;
        display: block;
        list-style-image: url(/images/shortcode-tick.webp);
        margin-block-start: 1em;
        margin-block-end: 1em;
        margin-inline-start:0;
        margin-inline-end:0;
        padding-inline-start:40px;
    }

    .book-list li {
        font-weight: bold;
    }

    @media (max-width: 600px) {
        .container {
            grid-template-columns: 1fr;
        }
    }

</style>
<div class="container">
    <div class="left-col">
        <a href="https://ksafjanuser.gumroad.com/l/mlops">
            <img src="/images/mlop_interview_book_cover_3D_300px.jpg" class="image" alt="Interview Book Cover">
        </a>

        <div class="center">
            <a href="https://ksafjanuser.gumroad.com/l/mlops">
                <button class="button">Get for $2.99</button>
            </a>
        </div>
    </div>
    <div class="right-col">
        <div>
            <ul class="book-list">
                <li>PDF, ePUB, mobi format ebook, no DRM</li>
                <li>50 questions and answers</li>
                <li>Stories from real projects</li>
                <li>92 multiple choice quiz questions</li>
                <li>80 pages</li>
            </ul>
        </div>
    </div>
</div>
</aside>
<main>

        <nav>
            <a href="https://www.safjan.com/">Home</a>

                <a href="/archives.html">Articles</a>
                <a href="/til.html">Notes</a>
                <a href="/categories.html">Categories</a>
                <a href="/tags.html">Tags</a>
                <a href="/pdfs/Krystian_Safjan_resume_priv.pdf">Resume</a>

                <a href="https://www.safjan.com/feeds/all.atom.xml">Atom</a>

                <a href="https://www.safjan.com/feeds/all.rss.xml">RSS</a>
        </nav>

    <article class="single">
        <header>
                
            <p>
                <!-- Posted on: -->
                2023-03-02 


                <br/>
            </p>
            <h1 id="ktrees_in_simple_terms">K-D Trees explained in simple terms</h1>
            <div class="header-underline"></div>
                <p class="summary"><p>Discover the power of k-d trees for multi-dimensional data organization and search. Learn how to efficiently find nearest neighbors and points within a given range.</p></p>



        </header>


        <div>
            <h2>Introduction</h2>
<p>K-d trees are a popular data structure used for efficiently storing and searching for data in multi-dimensional space. K-d trees are commonly used in computer graphics, image processing, and machine learning. In this blog post, we will discuss what k-d trees are, how they work, and how they can be used.</p>
<p><img alt="kd tree" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Tree_0001.svg/740px-Tree_0001.svg.png"></p>
<h2>K-D Tree</h2>
<h3>What is a k-d tree?</h3>
<p>A k-d tree is a binary search tree that is used to organize points in k-dimensional space. Each node in the tree represents a k-dimensional point, and each subtree represents a subset of the k-dimensional space. The k-d tree is constructed by recursively partitioning the space into smaller and smaller regions.</p>
<p>The name k-d tree comes from the fact that the tree is constructed by repeatedly splitting the space along one of the k dimensions. In other words, the first level of the tree will split the space into two regions along the first dimension, the second level will split each of these regions into two regions along the second dimension, and so on.</p>
<h3>How does a k-d tree work?</h3>
<p>The construction of a k-d tree involves selecting a splitting dimension and a splitting value for each level of the tree. The splitting dimension is chosen by selecting the dimension that has the highest variance among the points in the current subtree. The splitting value is chosen by selecting the median value of the points in the splitting dimension.</p>
<p>Once the splitting dimension and value have been chosen, the space is partitioned into two regions based on whether the points lie on the "left" or "right" side of the splitting value. The points on the left side are inserted into the left subtree, and the points on the right side are inserted into the right subtree. This process is repeated recursively until each node in the tree represents a single point.</p>
<p>When searching for a point in a k-d tree, the tree is traversed recursively starting at the root node. At each level of the tree, the search algorithm determines which side of the splitting plane the query point lies on, and recursively searches the subtree on that side of the plane. If the query point lies exactly on the splitting plane, the algorithm will search both subtrees.</p>
<h2>Advantages of k-d trees</h2>
<p>K-d trees have several advantages over other data structures for organizing points in multi-dimensional space. One of the main advantages is that k-d trees can be constructed efficiently, with a time complexity of O(n log n) in the average case. This makes k-d trees a good choice for applications that require fast construction of the data structure.</p>
<p>Another advantage of k-d trees is that they can be used to perform range searches efficiently. Range searches involve finding all points within a given distance of a query point. K-d trees can perform range searches in O(sqrt(n) + k) time, where k is the number of points found within the range.</p>
<p>K-d trees are also useful for nearest neighbor searches. Nearest neighbor searches involve finding the point in the tree that is closest to a given query point. K-d trees can perform nearest neighbor searches in O(log n) time on average.</p>
<h3>Disadvantages of k-d trees</h3>
<p>While k-d trees have several advantages, they also have some disadvantages. One of the main disadvantages is that the performance of k-d trees can degrade rapidly as the dimensionality of the data increases. This is known as the "curse of dimensionality", and it can make k-d trees impractical for high-dimensional data.</p>
<p>Another disadvantage of k-d trees is that they can be sensitive to the order in which the points are inserted into the tree. If the points are inserted in a way that causes the tree to be unbalanced, the performance of the tree can suffer.</p>
<h2>Example</h2>
<p>Let's demonstrate the k-d tree algorithm using a simple example. Consider the following set of 2-dimensional points:</p>
<div class="highlight"><pre><span></span><code>[(2,3), (5,4), (9,6), (4,7), (8,1), (7,2)]
</code></pre></div>

<p>To construct a k-d tree for these points, we start by selecting a splitting dimension and splitting value for the root node. In this case, we will choose the x-axis as the splitting dimension and the median x-value (7) as the splitting value.</p>
<div class="highlight"><pre><span></span><code>     (7,2)
</code></pre></div>

<p>Next, we split the points into two subsets based on whether they lie to the left or right of the splitting value:</p>
<div class="highlight"><pre><span></span><code>     (7,2)
     /    \
(2,3)  (5,4)  (9,6)  (4,7)  (8,1)
</code></pre></div>

<p>We now have two subtrees, one containing the points to the left of the splitting value and one containing the points to the right. We can repeat the splitting process for each subtree recursively.</p>
<p>For the left subtree, we choose the y-axis as the splitting dimension and the median y-value (3.5) as the splitting value:</p>
<div class="highlight"><pre><span></span><code>        (7,2)
        /    \
 (5,4)       (2,3)
           /      \
       (4,7)    (8,1)  (9,6)
</code></pre></div>

<p>For the right subtree, we choose the y-axis as the splitting dimension and the median y-value (5) as the splitting value:</p>
<div class="highlight"><pre><span></span><code>        (7,2)
        /    \
 (5,4)        (9,6)
           /       \
      (8,1)     (2,3)   (4,7)
</code></pre></div>

<p>We have now constructed a k-d tree for the set of points. To search for a nearest neighbor of a query point, we start at the root node and recursively traverse the tree, choosing the subtree on the same side of the splitting plane as the query point at each level.</p>
<p>For example, if we want to find the nearest neighbor of the point (3,5), we start at the root node and compare the distance between (3,5) and (7,2) to the distance between (3,5) and the splitting plane along the x-axis. Since (3,5) lies to the left of the splitting plane, we traverse the left subtree.</p>
<p>At the next level, we compare the distance between (3,5) and the point (5,4) to the distance between (3,5) and the splitting plane along the y-axis. Since (3,5) lies above the splitting plane, we traverse the right subtree.</p>
<p>At the next level, we compare the distance between (3,5) and the point (2,3) to the distance between (3,5) and the splitting plane along the x-axis. Since (3,5) lies to the right of the splitting plane, we traverse the right subtree.</p>
<p>At the final level, we compare the distance between (3,5) and the point (4,7) to the distance between (3,5) and the point (8,1), which are the only two points in the subtree. We find that the nearest neighbor of (3,5) is (4,7).</p>
<p>In Python, we can construct a k-d tree using the <code>scipy</code> library:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">KDTree</span>

<span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</code></pre></div>

<p>Once we have constructed the k-d tree, we can perform various types of queries such as nearest neighbor search and range search. For example, to find the nearest neighbor of a query point, we can use the <code>query</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="n">query_point</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">distance</span><span class="p">,</span> <span class="n">nearest_point</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_point</span><span class="p">)</span>
</code></pre></div>

<p>This will return the distance between the query point and its nearest neighbor in the k-d tree, as well as the coordinates of the nearest neighbor.</p>
<p>We can also perform range searches to find all points within a certain distance from a query point:</p>
<div class="highlight"><pre><span></span><code><span class="n">query_point</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">query_point</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
</code></pre></div>

<p>This will return a list of indices of all points within a radius of 2 units from the query point.</p>
<h2>Conclusion</h2>
<p>K-d trees are a powerful data structure for organizing points in multi-dimensional space. They offer efficient construction and fast searches for nearest neighbors and points within a given range. However, k-d trees can suffer from the curse of dimensionality and can be sensitive to the order in which points are inserted.</p>
<p>In applications where the dimensionality of the data is high, other data structures such as ball trees or cover trees may be more suitable. Overall, k-d trees are a valuable tool for efficient multi-dimensional data organization and searching.</p>
<h2>Related variations</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Quadtree" title="Quadtree">Quadtree</a>, a space-partitioning structure that splits in two dimensions simultaneously, so that each node has 4 children</li>
<li><a href="https://en.wikipedia.org/wiki/Octree" title="Octree">Octree</a>, a space-partitioning structure that splits in three dimensions simultaneously, so that each node has 8 children</li>
<li><a href="https://en.wikipedia.org/wiki/Ball_tree" title="Ball tree">Ball tree</a>, a multi-dimensional space partitioning useful for nearest neighbor search</li>
<li><a href="https://en.wikipedia.org/wiki/R-tree" title="R-tree">R-tree</a> and <a href="https://en.wikipedia.org/wiki/Bounding_interval_hierarchy" title="Bounding interval hierarchy">bounding interval hierarchy</a>, structure for partitioning objects rather than points, with overlapping regions</li>
<li><a href="https://en.wikipedia.org/wiki/Vantage-point_tree" title="Vantage-point tree">Vantage-point tree</a>, a variant of a <em>k</em>-d tree that uses hyperspheres instead of hyperplanes to partition the data</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/K-d_tree">k-d tree - Wikipedia</a></li>
<li><a href="https://www.astroml.org/book_figures/chapter2/fig_kdtree_example.html">KD Tree Example — astroML 0.4 documentation</a></li>
<li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KDTree.html">sklearn.neighbors.KDTree — scikit-learn 1.2.1 documentation</a></li>
<li></li>
</ul>
        </div>




            <div class="bibtex-note">
                <p><b>To cite this article:</b></p>
                <pre>@article{Saf2023K-D,
    author  = {Krystian Safjan},
    title   = {K-D Trees explained in simple terms},
    journal = {Krystian's Safjan Blog},
    year    = {2023},
}</pre>
            </div>
        <div class="tag-cloud">
            <p>
                    <br/><br/>Tags:&nbsp;
                        <a href="https://www.safjan.com/tag/k-d-tree/">k-d-tree</a>
                        <a href="https://www.safjan.com/tag/binary-search-tree/">binary-search-tree</a>
                        <a href="https://www.safjan.com/tag/multi-dimensional-space/">multi-dimensional-space</a>
                        <a href="https://www.safjan.com/tag/computer-graphics/">computer-graphics</a>
                        <a href="https://www.safjan.com/tag/image-processing/">image-processing</a>
                        <a href="https://www.safjan.com/tag/machine-learning/">machine-learning</a>
                        <a href="https://www.safjan.com/tag/data-structure/">data-structure</a>
                        <a href="https://www.safjan.com/tag/search-algorithm/">search-algorithm</a>
                        <a href="https://www.safjan.com/tag/nearest-neighbor-search/">nearest-neighbor-search</a>
                        <a href="https://www.safjan.com/tag/range-search/">range-search</a>
                        <a href="https://www.safjan.com/tag/ball-trees/">ball-trees</a>
                        <a href="https://www.safjan.com/tag/cover-trees/">cover-trees</a>
                        <a href="https://www.safjan.com/tag/curse-of-dimensionality/">curse-of-dimensionality</a>
                        <a href="https://www.safjan.com/tag/efficient-data-organization/">efficient-data-organization</a>
            </p>
        </div>








            <div class="related-posts">
                <h4>You might enjoy</h4>
                <ul class="related-posts">
                        <li><a href="https://www.safjan.com/the-best-vector-databases-for-storing-embeddings/">The best vector databases for storing embeddings</a></li>
                        <li><a href="https://www.safjan.com/how-the-lime-method-for-explainable-ai-works/">LIME - Understanding How This Method for Explainable AI Works</a></li>
                        <li><a href="https://www.safjan.com/how-the-shap-method-for-explainable-ai-works/">SHAP - Understanding How This Method for Explainable AI Works</a></li>
                        <li><a href="https://www.safjan.com/lime-tutorial/">LIME Tutorial</a></li>
                        <li><a href="https://www.safjan.com/contextual_understanding-speech-to-text/">Contextual Understanding in Automated Speech-to-Text Transcription: Machine Learning Techniques and Challenges</a></li>
                </ul>
            </div>

  <div class="neighbors">
  </div>


    </article>

    <footer>
<p>
  &copy; 2023 Krystian Safjan - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
</main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Krystian Safjan's Blog ",
  "url" : "https://www.safjan.com",
  "image": "/images/profile_new.jpg",
  "description": ""
}
</script>

</body>
</html>