
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"/>
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
              rel="stylesheet">

        <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/stylesheet/style.min.css">



        <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              href="https://www.safjan.com/theme/pygments/github.min.css">



    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/solid.css">

        <link rel="stylesheet" type="text/css"
              href="https://www.safjan.com/styles/custom.css">

        <link href="https://www.safjan.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Krystian Safjan's Blog Atom">

        <link href="https://www.safjan.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Krystian Safjan's Blog RSS">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RM2PKDCCYM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RM2PKDCCYM');
</script>
<!-- End of Google tag (gtag.js) -->



    <meta name="author" content="Krystian Safjan"/>
    <meta name="description" content="Introduction In the realm of natural language processing and text analysis, it is often necessary to split a large piece of text into smaller parts while ensuring that the split does not break words or disrupt the meaning of the text. This …"/>
    <meta name="keywords" content="tokenization, tiktoken, prompt-chunking, split-text, text-partitioning, openai, gpt-4">
    <meta expr:content="2023-07-03 00:00:00+02:00" itemprop='datePublished'/>
    <meta expr:content="2023-07-12 00:00:00+02:00" itemprop='dateModified'/>
    <meta property="article:modified_time" content="2023-07-12 00:00:00+02:00"/>
    <meta property="article:published_time" content="2023-07-03 00:00:00+02:00"/>
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Introducing a Python Module for Splitting Text Into Parts Based on Token Limit",
  "datePublished": "2023-07-03 00:00:00+02:00",
  "dateModified": "2023-07-12 00:00:00+02:00"
}








    </script>



  <meta property="og:site_name" content="Krystian Safjan's Blog"/>
  <meta property="og:title" content="Introducing a Python Module for Splitting Text Into Parts Based on Token Limit"/>
  <meta property="og:description" content="Introduction In the realm of natural language processing and text analysis, it is often necessary to split a large piece of text into smaller parts while ensuring that the split does not break words or disrupt the meaning of the text. This …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://www.safjan.com/token-split-text/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-07-03 00:00:00+02:00"/>
  <meta property="article:modified_time" content="2023-07-12 00:00:00+02:00"/>
  <meta property="article:author" content="https://www.safjan.com/author/krystian-safjan/">
  <meta property="article:section" content="note"/>
  <meta property="article:tag" content="tokenization"/>
  <meta property="article:tag" content="tiktoken"/>
  <meta property="article:tag" content="prompt-chunking"/>
  <meta property="article:tag" content="split-text"/>
  <meta property="article:tag" content="text-partitioning"/>
  <meta property="article:tag" content="openai"/>
  <meta property="article:tag" content="gpt-4"/>
  <meta property="og:image" content="/images/profile_new.jpg">

    <meta name="twitter:card" content="summary"/>
    <meta property="twitter:image" content="/images/profile_new.jpg">

    <meta name="twitter:label1" content="Est. reading time"/>
    <meta name="twitter:data1" content="4 min."/>
    <meta name="twitter:site" content="@izikeros"/>
    <meta name="twitter:description" content=""/>
    <meta name="twitter:title" content="Introducing a Python Module for Splitting Text Into Parts Based on Token Limit"/>


    <title>    Introducing a Python Module for Splitting Text Into Parts Based on Token Limit
</title>


<!-- Google Automatic Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9767732578835199"
     crossorigin="anonymous"></script>
<!-- End of Google Automatic Ads -->


</head>
<body class="light-theme">
<aside>
    <div>
        <a href="https://www.safjan.com/">
                <img src="/images/profile_new.jpg" alt="Krystian Safjan's Blog" title="Krystian Safjan's Blog" width="140" height="140">
        </a>

        <h1>
            <a href="https://www.safjan.com/">Krystian Safjan's Blog</a>
        </h1>

<p>Data Scientist | Researcher | Team Leader<br><br> working at Ernst &amp; Young and writing about <a href="/category/machine-learning.html">Data Science and Visualization</a>, on <a href="/category/machine-learning.html">Machine Learning, Deep Learning</a> and <a href="/tag/nlp/">NLP</a>. There are also some  <a href="/category/howto.html">howto</a> posts on tools and workflows.</p>




        <ul class="social">
                <li>
                    <a  class="sc-linkedin" href="https://pl.linkedin.com/in/krystiansafjan"
                       target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/izikeros"
                       target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-envelope" href="mailto:ksafjan@gmail.com"
                       target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-graduation-cap" href="https://scholar.google.pl/citations?user=UlNJgMoAAAAJ"
                       target="_blank">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-rss" href="/feeds/all.rss.xml"
                       target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>

<style>
    .button {
        background-color: yellow;
        color: black;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 20px;
    }

    .center {
        text-align: center;
    }

    .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }

    .left-col {
    }

    .right-col {
    }

    .image {
        border-radius: 0;
        width: 100%;
    }

    .book-list {
        padding-top:0;
        padding-bottom: 0;
        text-align:left;
        box-sizing: border-box;
        display: block;
        list-style-image: url(/images/shortcode-tick.webp);
        margin-block-start: 1em;
        margin-block-end: 1em;
        margin-inline-start:0;
        margin-inline-end:0;
        padding-inline-start:40px;
    }

    .book-list li {
        font-weight: bold;
    }

    @media (max-width: 600px) {
        .container {
            grid-template-columns: 1fr;
        }
    }

</style>
<div class="container">
    <div class="left-col">
        <a href="https://ksafjanuser.gumroad.com/l/mlops">
            <img src="/images/mlop_interview_book_cover_3D_300px.jpg" class="image" alt="Interview Book Cover">
        </a>

        <div class="center">
            <a href="https://ksafjanuser.gumroad.com/l/mlops">
                <button class="button">Get for $0.99</button>
            </a>
        </div>
    </div>
    <div class="right-col">
        <div>
            <ul class="book-list">
                <li>PDF, ePUB, mobi format ebook, no DRM</li>
                <li>50 questions and answers</li>
                <li>Stories from real projects</li>
                <li>92 multiple choice quiz questions</li>
                <li>80 pages</li>
            </ul>
        </div>
    </div>
</div>
</aside>
<main>

        <nav>
            <a href="https://www.safjan.com/">Home</a>

                <a href="/archives.html">Articles</a>
                <a href="/til.html">Notes</a>
                <a href="/categories.html">Categories</a>
                <a href="/pdfs/Krystian_Safjan_resume_priv.pdf">Resume</a>

                <a href="https://www.safjan.com/feeds/all.atom.xml">Atom</a>

                <a href="https://www.safjan.com/feeds/all.rss.xml">RSS</a>
        </nav>

    <article class="single">
        <header>
                
            <p>
                <!-- Posted on: -->
                2023-07-03 



                    <span id="post-share-links">
    &nbsp;&nbsp;&nbsp;Share on:
    <a href="https://twitter.com/intent/tweet?text=Introducing%20a%20Python%20Module%20for%20Splitting%20Text%20Into%20Parts%20Based%20on%20Token%20Limit&url=https%3A//www.safjan.com/token-split-text/&hashtags=tokenization,tiktoken,prompt-chunking,split-text,text-partitioning,openai,gpt-4" target="_blank" title="Share on Twitter">Twitter</a>
    |
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//www.safjan.com/token-split-text/" target="_blank" title="Share on Facebook">Facebook</a>
    |
    <a href="https://news.ycombinator.com/submitlink?t=Introducing%20a%20Python%20Module%20for%20Splitting%20Text%20Into%20Parts%20Based%20on%20Token%20Limit&u=https%3A//www.safjan.com/token-split-text/" target="_blank" title="Share on HackerNews">HackerNews</a>
    |
    <a href="https://www.reddit.com/submit?url=https%3A//www.safjan.com/token-split-text/&title=Introducing%20a%20Python%20Module%20for%20Splitting%20Text%20Into%20Parts%20Based%20on%20Token%20Limit" target="_blank" title="Share via Reddit">Reddit</a>
  </span>
                <br/>
            </p>
            <h1 id="token-split-text">Introducing a Python Module for Splitting Text Into Parts Based on Token Limit</h1>
            <div class="header-underline"></div>



        </header>


        <div>
            <h2>Introduction</h2>
<p>In the realm of natural language processing and text analysis, it is often necessary to split a large piece of text into smaller parts while ensuring that the split does not break words or disrupt the meaning of the text. This task can be challenging, especially when dealing with the tokenization. However, with the help of the Tiktoken library and a custom Python module, splitting text based on a specified number of tokens can be an easy task.</p>
<h2>Understanding the Tiktoken Library</h2>
<p>Tiktoken is a powerful Python library for tokenization, which is the process of splitting text into individual tokens such as words or subwords. The library provides various tokenization encodings and functions that enable developers to process text data in a tokenized format. It offers support for different languages and tokenization models, making it a versatile tool for a wide range of text processing tasks. Tiktoken is a fast <a href="https://en.wikipedia.org/wiki/Byte_pair_encoding">BPE</a> tokeniser for use with OpenAI's models.</p>
<h2>Introducing the Python Module: split_string_with_limit</h2>
<p>The provided Python module: <a href="https://gist.github.com/izikeros/17d9c8ab644bd2762acf6b19dd0cea39">split_string_with_limit.py</a> (GitHub Gist), leverages the capabilities of the Tiktoken library to split a string into parts with a specified limit on the number of tokens per part. The module takes three parameters: <code>text</code>, <code>limit</code>, and <code>encoding</code>.</p>
<ul>
<li><code>text</code>: The input string that needs to be split.</li>
<li><code>limit</code>: The maximum number of tokens allowed per part.</li>
<li><code>encoding</code>: The tokenization encoding to be used, which determines how the text is tokenized.</li>
</ul>
<p>The module proceeds as follows:</p>
<ol>
<li>It tokenizes the input text using the specified encoding from Tiktoken.</li>
<li>It creates an empty list, <code>parts</code>, to store the tokenized parts.</li>
<li>It initializes a <code>current_part</code> list and a <code>current_count</code> variable to keep track of the tokens in the current part.</li>
<li>It iterates over each token in the tokenized text.</li>
<li>For each token, it appends it to the <code>current_part</code> list and increments the <code>current_count</code> by 1.</li>
<li>If the <code>current_count</code> exceeds the specified limit, it adds the <code>current_part</code> to the <code>parts</code> list, resets the <code>current_part</code> and <code>current_count</code> to empty values, and continues with the next tokens.</li>
<li>Once all the tokens have been processed, the module checks if there is any remaining <code>current_part</code> and adds it to the <code>parts</code> list.</li>
<li>Finally, it converts each tokenized part back into text format by decoding the individual tokens and joins them together. The resulting text parts are stored in the <code>text_parts</code> list.</li>
<li>The module returns the <code>text_parts</code> list as the output.</li>
</ol>
<h2>Example Usage</h2>
<p>To demonstrate the usage of the <code>split_string_with_limit</code> module, let's consider an example:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>split_string_with_limit.py<span class="w"> </span>input_file.txt<span class="w"> </span><span class="m">100</span><span class="w"> </span>cl100k_base
</code></pre></div>

<p>In this example, we provide three arguments:</p>
<ol>
<li><code>input_file.txt</code>: The path to the input text file that contains the text to be split.</li>
<li><code>100</code>: The maximum number of tokens allowed per part. You can adjust this value based on your requirements.</li>
<li><code>cl100k_base</code>: The encoding name. This determines how the text will be tokenized. Tiktoken provides various encoding options, and you can experiment with different encodings to achieve the desired results.</li>
</ol>
<p>The module reads the text from the input file, tokenizes it using the specified encoding, and splits it into parts based on the token limit. The resulting text parts are then printed in a JSON format, providing a structured representation of the split text.</p>
<h2>Approximate approach</h2>
<p>While the <code>split_string_with_limit</code> module offers a convenient solution for splitting text based on a token limit, it's worth mentioning alternative algorithms or approaches that can achieve similar results. One of these can be a <strong>Fixed-Length Split</strong>: instead of splitting based on the number of tokens, we could split the text into fixed-length segments based on counting words or characters. One can use <a href="https://platform.openai.com/tokenizer">rule of thumb</a>:</p>
<blockquote>
<p>A helpful rule of thumb is that one token generally corresponds to ~4 characters of text for common English text. This translates to roughly ¾ of a word (so 100 tokens ~= 75 words).</p>
</blockquote>
<p>to have approximate of the split into parts of equal length without doing actual tokenization.</p>
<h2>Conclusion</h2>
<p>In this blog post, we introduced the <code>split_string_with_limit</code> Python module, which leverages the power of the Tiktoken library to split a string into parts based on a specified token limit. We discussed the functionality of the module, its parameters, and how it can be used in practice. Furthermore, we explored alternative algorithms and approaches for splitting text based on the number of tokens. By combining the flexibility of Tiktoken and the convenience of the <code>split_string_with_limit</code> module, developers can efficiently process and analyze text data without compromising on accuracy or readability.</p>
        </div>


        <div class="tag-cloud">
            <p>
                    <br/><br/>Tags:&nbsp;
                        <a href="https://www.safjan.com/tag/tokenization/">tokenization</a>
                        <a href="https://www.safjan.com/tag/tiktoken/">tiktoken</a>
                        <a href="https://www.safjan.com/tag/prompt-chunking/">prompt-chunking</a>
                        <a href="https://www.safjan.com/tag/split-text/">split-text</a>
                        <a href="https://www.safjan.com/tag/text-partitioning/">text-partitioning</a>
                        <a href="https://www.safjan.com/tag/openai/">openai</a>
                        <a href="https://www.safjan.com/tag/gpt-4/">gpt-4</a>
            </p>
        </div>








            <div class="related-posts">
                <h4>You might enjoy</h4>
                <ul class="related-posts">
                        <li><a href="https://www.safjan.com/how-to-count-tokens/">How to Count Tokens - Tokenization With Tiktoken.</a></li>
                        <li><a href="https://www.safjan.com/punctuation-restoration/">Punctuation Restoration</a></li>
                        <li><a href="https://www.safjan.com/script-to-python-package-using-poetry-and-pycharm/">Script to Python Package Using Poetry (And PyCharm)</a></li>
                        <li><a href="https://www.safjan.com/split-glued-or-joined-words/">Split glued or joined words</a></li>
                        <li><a href="https://www.safjan.com/problems-with-Langchain-and-how-to-minimize-their-impact/">Problems with Langchain and how to minimize their impact</a></li>
                </ul>
            </div>

  <div class="neighbors">
    <a class="btn float-left" href="https://www.safjan.com/demystifying-perplexity-assessing-dimensionality-reduction-with-pca/" title="Demystifying Perplexity - Assessing Dimensionality Reduction With PCA">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="https://www.safjan.com/text-vectorization-with-vectorhub-and-sentence-transformers/" title="Easy Text Vectorization With VectorHub and Sentence Transformers">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>


    </article>

    <footer>
<p>
  &copy; 2023 Krystian Safjan - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
</main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Krystian Safjan's Blog ",
  "url" : "https://www.safjan.com",
  "image": "/images/profile_new.jpg",
  "description": ""
}
</script>

</body>
</html>