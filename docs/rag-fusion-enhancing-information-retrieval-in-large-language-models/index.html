
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="color-scheme" content="light dark"/>
    <script>
      (function() {
        var theme = localStorage.getItem('theme-preference');
        if (theme === 'dark' || theme === 'light') {
          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"/>
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
              rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/stylesheet/style.css">


    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/pygments/github.min.css">


    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://www.safjan.com/theme/font-awesome/css/solid.css">

    <link rel="stylesheet" href="https://www.safjan.com/pagefind/pagefind-ui.css">

        <link rel="stylesheet" type="text/css"
              href="https://www.safjan.com/styles/custom.css">

        <link href="https://www.safjan.com/feeds/all.atom.xml?utm_source=rss&utm_medium=feed&utm_campaign=rss-feed" type="application/atom+xml" rel="alternate"
              title="Krystian Safjan's Blog Atom">

        <link href="https://www.safjan.com/feeds/all.rss.xml?utm_source=rss&utm_medium=feed&utm_campaign=rss-feed" type="application/rss+xml" rel="alternate"
              title="Krystian Safjan's Blog RSS">


    <link rel="apple-touch-icon" sizes="180x180" href="https://www.safjan.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.safjan.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.safjan.com/favicon-16x16.png">
    <link rel="shortcut icon" href="https://www.safjan.com/favicon.ico">
    <link rel="manifest" href="https://www.safjan.com/site.webmanifest">
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-title" content="Krystian Safjan's Blog">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RM2PKDCCYM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RM2PKDCCYM');
</script>
<!-- End of Google tag (gtag.js) -->



    <meta name="author" content="Krystian Safjan"/>
    <meta name="description" content="Learn about RAG-fusion, a technique that generates multiple query versions from user input and re-ranks them to enhance information retrieval in Large Language Models, providing more relevant responses."/>
    <meta name="keywords" content="llm, information-retrieval, rag, re-ranking, semantic-search, llm-technique">


  <meta property="og:site_name" content="Krystian Safjan's Blog"/>
  <meta property="og:title" content="RAG-Fusion - Enhancing Information Retrieval in Large Language Models"/>
  <meta property="og:description" content="Learn about RAG-fusion, a technique that generates multiple query versions from user input and re-ranks them to enhance information retrieval in Large Language Models, providing more relevant responses."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://www.safjan.com/rag-fusion-enhancing-information-retrieval-in-large-language-models/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-11-06 00:00:00+01:00"/>
  <meta property="article:modified_time" content="2023-11-06 00:00:00+01:00"/>
  <meta property="article:author" content="https://www.safjan.com/author/krystian-safjan/"/>
  <meta property="article:section" content="note"/>
  <meta property="article:tag" content="llm"/>
  <meta property="article:tag" content="information-retrieval"/>
  <meta property="article:tag" content="rag"/>
  <meta property="article:tag" content="re-ranking"/>
  <meta property="article:tag" content="semantic-search"/>
  <meta property="article:tag" content="llm-technique"/>
  <meta property="og:image" content="/images/profile_new.jpg"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image" content="/images/profile_new.jpg"/>
    <meta name="twitter:image:alt" content="Krystian Safjan's Blog"/>


    <meta name="twitter:site" content="@izikeros"/>
    <meta name="twitter:creator" content="@izikeros"/>
    <meta name="twitter:title" content="RAG-Fusion - Enhancing Information Retrieval in Large Language Models"/>
    <meta name="twitter:description" content="Learn about RAG-fusion, a technique that generates multiple query versions from user input and re-ranks them to enhance information retrieval in Large Language Models, providing more relevant..."/>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.safjan.com/rag-fusion-enhancing-information-retrieval-in-large-language-models/"
  },
  "headline": "RAG-Fusion - Enhancing Information Retrieval in Large Language Models",
  "datePublished": "2023-11-06T00:00:00+01:00",
  "dateModified": "2023-11-06T00:00:00+01:00",
  "author": {
    "@type": "Person",
    "name": "Krystian Safjan",
    "url": "https://www.safjan.com/author/krystian-safjan/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Krystian Safjan's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/profile_new.jpg"
    }  },
"image": "/images/profile_new.jpg",  "url": "https://www.safjan.com/rag-fusion-enhancing-information-retrieval-in-large-language-models/",
  "description": "Learn about RAG-fusion, a technique that generates multiple query versions from user input and re-ranks them to enhance information retrieval in Large...",
  "articleSection": "note",
  "inLanguage": "en",
  "keywords": "llm, information-retrieval, rag, re-ranking, semantic-search, llm-technique",
  "wordCount": 540,
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": ["article h1", ".summary", ".tldr", "article \u003e p:first-of-type"]
  }}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://www.safjan.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "note",
      "item": "https://www.safjan.com/category/note.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "RAG-Fusion - Enhancing Information Retrieval..."
    }
  ]
}
</script>



<meta name="ai:summary" content="Learn about RAG-fusion, a technique that generates multiple query versions from user input and re-ranks them to enhance information retrieval in Large Language Models, providing more relevant responses.">

<meta name="ai:topics" content="llm, information-retrieval, rag, re-ranking, semantic-search, llm-technique">



<meta name="ai:word-count" content="540">
<meta name="ai:reading-time" content="2 min">

<meta name="ai:section" content="note">



<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">

    <title>    RAG-Fusion - Enhancing Information Retrieval in Large Language Models
</title>



<!-- Google Automatic Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9767732578835199"
     crossorigin="anonymous"></script>
<!-- End of Google Automatic Ads -->


</head>
<body>
<div id="reading-progress" class="reading-progress"></div>
<aside>
    <div>
        <a href="https://www.safjan.com/">
                <img src="/images/profile_new.jpg" alt="Krystian Safjan's Blog" title="Krystian Safjan's Blog" width="140" height="140">
        </a>

        <h1>
            <a href="https://www.safjan.com/">Krystian Safjan's Blog</a>
        </h1>

<p>Data Scientist and Team Leader writing about Machine Learning, MLOps, and Python</p>


        <ul class="social">
                <li>
                    <a  class="sc-linkedin" href="https://pl.linkedin.com/in/krystiansafjan"
                       target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/izikeros"
                       target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-envelope" href="mailto:ksafjan@gmail.com"
                       target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-graduation-cap" href="https://scholar.google.pl/citations?user=UlNJgMoAAAAJ"
                       target="_blank">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-rss" href="/feeds/all.rss.xml"
                       target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>

<div class="promo-box">
    <a href="https://ksafjanuser.gumroad.com/l/mlops" class="promo-box-image">
        <img src="/images/mlop_interview_book_cover_3D_300px.jpg" alt="MLOps Interview Book Cover">
    </a>
    
    <p class="promo-box-headline">Ace Your MLOps Interview</p>
    
    <a href="https://ksafjanuser.gumroad.com/l/mlops" class="promo-box-cta">
        Get for $2.99
    </a>
    
    <p class="promo-box-features">50 Q&A â€¢ PDF/ePUB/mobi</p>
</div>
</aside>
<main>

        <nav aria-label="Main navigation">
            <a href="https://www.safjan.com/">Home</a>

                <a href="/archives.html">Articles</a>
                <a href="/til.html">Notes</a>
                <a href="/categories.html">Categories</a>
                <a href="/pdfs/Krystian_Safjan_resume_priv.pdf">Resume</a>

                <a href="https://www.safjan.com/feeds/all.atom.xml">Atom</a>

                <a href="https://www.safjan.com/feeds/all.rss.xml">RSS</a>

            <div id="search" class="nav-search"></div>
            <button type="button" id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
            </button>
        </nav>

    <article class="single">
        <header>
                
            <p>
                <!-- Posted on: -->
                2023-11-06 


                <br/>
            </p>
            <h1>RAG-Fusion - Enhancing Information Retrieval in Large Language Models</h1>
            <div class="header-underline"></div>



        </header>




        <div class="article-content">
            <p>In the realm of Large Language Models (LLMs) such as ChatGPT, a new technique known as Retrieval Augmented Generation (RAG) is gaining prominence. This technique is designed to enhance a user's input by incorporating additional information from an external source. This supplementary data is then leveraged by the LLM to enrich the response it generates. In this blog post, we will look deeper into the core concept of RAG-fusion, which revolves around multiple query generation and re-ranking of results. For other methods that can improve RAG performance see my other <a href="https://www.safjan.com/techniques-to-boost-rag-performance-in-production/">Techniques to Boost RAG Performance in Production</a>.</p>
<h2 id="what-is-rag-fusion">What is RAG-fusion?</h2>
<p><strong>The principle behind RAG-fusion is to generate multiple versions of the user's original query using a LLM, and then re-rank the results to select the most relevant retrieved parts.</strong></p>
<blockquote>
<p>NOTE: The term RAG in the name of the technique might be a bit misleading since "RAG-fusion" refers only to the first part of RAG - retrieval process.</p>
</blockquote>
<p>How it works? For instance, the prompt template for this task might look something like this: "Generate multiple search queries related to: {original_query}", where <code>{original_query}</code> is a placeholder for the user's original query. This step enables the model to explore different perspectives and interpretations of the original query, thereby broadening the range of potential responses.</p>
<h2 id="re-ranking-a-crucial-step">Re-ranking: A Crucial Step</h2>
<p>The next vital step in the RAG-fusion process is re-ranking. This step is critical in determining the most pertinent answers to the user's query. The re-ranking process, often referred to as Reciprocal Rank Fusion (RRF), involves collecting ranked search outcomes from multiple strategies.</p>
<p>Each document is assigned a reciprocal rank score. These scores are then merged to create a new ranking. The underlying principle here is that documents that consistently appear in top positions across diverse search strategies are likely more pertinent and should, therefore, receive a higher rank in the consolidated result.</p>
<p><img alt="RAG Fusion" src="https://miro.medium.com/v2/resize:fit:1400/1*tDALPmWxwAPf7UADpZwjWQ@2x.jpeg">
Figure 1. RAG fusion proces flow for ranking four documents A, B, C, D against three retrieval sources (can be three variants of the original user query). Source of image: <a href="https://towardsdatascience.com/forget-rag-the-future-is-rag-fusion-1147298d8ad1">Forget RAG, the Future is RAG-Fusion article by Adrian H. Raudaschl</a></p>
<h2 id="why-rag-fusion-matters">Why RAG-fusion Matters?</h2>
<p>It provides a boost to the LLM's ability to generate more accurate, contextually relevant responses. By considering multiple interpretations of the original query and re-ranking the results, it ensures that the model's output is as closely aligned with the user's intent as possible.</p>
<p>RAG-fusion might be a powerful technique that brings together the strengths of large language models and advanced information retrieval strategies. By employing multiple query generation and re-ranking, it takes a leap towards making AI-powered systems more responsive, accurate, and user-friendly.</p>
<p><strong>NOTE 1:</strong> For more methods that can improve RAG performance see my other <a href="https://www.safjan.com/techniques-to-boost-rag-performance-in-production/">Techniques to Boost RAG Performance in Production</a>.
<strong>NOTE 2:</strong> This technique is also referred as Query-Rewriting. You can find a section on that on LlamaIndex documentation (<a href="https://docs.llamaindex.ai/en/stable/examples/query_transformations/query_transform_cookbook.html">Query Transformation Cookbook</a>)</p>
<h2 id="-understanding-retrieval-augmented-generation-rag-empowering-llms">- <a href="https://www.safjan.com/understanding-retrieval-augmented-generation-rag-empowering-llms/">Understanding Retrieval-Augmented Generation (RAG) empowering LLMs</a></h2>
<p><strong>Edits:</strong></p>
<ul>
<li>2024-03-06: Added RAG fusion paper</li>
<li>2024-02-01: Add reference to LLamaIndex Query Transform Cookbook</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://arxiv.org/html/2402.03367v2">RAG-Fusion: a New Take on Retrieval-Augmented Generation</a></li>
<li><a href="https://github.com/Raudaschl/rag-fusion/tree/master">GitHub - Raudaschl/rag-fusion</a> - exemplary implementation</li>
<li><a href="https://towardsdatascience.com/forget-rag-the-future-is-rag-fusion-1147298d8ad1">Forget RAG, the Future is RAG-Fusion | by Adrian H. Raudaschl | Oct, 2023 | Towards Data Science</a></li>
<li>RAG-fusion in LangChain: <a href="https://python.langchain.com/docs/templates/rag-fusion">usage</a>, template <a href="https://github.com/langchain-ai/langchain/tree/master/templates/rag-fusion">code</a></li>
<li><a href="https://docs.llamaindex.ai/en/stable/examples/query_transformations/query_transform_cookbook.html">Query Transformation Cookbook</a></li>
</ul>
        </div>


        <div class="article-tags">
            <span class="tags-label">Tags:</span>
                <a href="https://www.safjan.com/tag/llm/" class="article-tag">llm</a>
                <a href="https://www.safjan.com/tag/information-retrieval/" class="article-tag">information-retrieval</a>
                <a href="https://www.safjan.com/tag/rag/" class="article-tag">rag</a>
                <a href="https://www.safjan.com/tag/re-ranking/" class="article-tag">re-ranking</a>
                <a href="https://www.safjan.com/tag/semantic-search/" class="article-tag">semantic-search</a>
                <a href="https://www.safjan.com/tag/llm-technique/" class="article-tag">llm-technique</a>
        </div>







            <div class="related-posts">
                <h4 class="related-posts-title">You might also like</h4>
                <div class="related-posts-grid">
                        <a href="https://www.safjan.com/techniques-to-boost-rag-performance-in-production/" class="related-post-card">
                            <span class="related-post-title">Techniques to Boost RAG Performance in Production</span>
                            <span class="related-post-date">Nov 01, 2023</span>
                        </a>
                        <a href="https://www.safjan.com/from-fixed-size-to-nlp-chunking-a-deep-dive-into-text-chunking-techniques/" class="related-post-card">
                            <span class="related-post-title">From Fixed-Size to NLP Chunking - A Deep Dive into Text Chunking Techniques</span>
                            <span class="related-post-date">Sep 11, 2023</span>
                        </a>
                        <a href="https://www.safjan.com/understanding-retrieval-augmented-generation-rag-empowering-llms/" class="related-post-card">
                            <span class="related-post-title">Understanding Retrieval-Augmented Generation (RAG) empowering LLMs</span>
                            <span class="related-post-date">Aug 24, 2023</span>
                        </a>
                        <a href="https://www.safjan.com/semantic-type-detection/" class="related-post-card">
                            <span class="related-post-title">Semantic Type Detection</span>
                            <span class="related-post-date">Dec 01, 2023</span>
                        </a>
                </div>
            </div>




    </article>

    <footer>
<p>
  &copy; 2026 Krystian Safjan - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>    </footer>
</main>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Krystian Safjan's Blog",
  "url": "https://www.safjan.com",
"image": "/images/profile_new.jpg",  "description": ""
}
</script>


<script src="https://www.safjan.com/pagefind/pagefind-ui.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', function() {
        new PagefindUI({
            element: "#search",
            showSubResults: false,
            showImages: false,
            basePath: "https://www.safjan.com/pagefind/"
        });
    });
</script>

<script src="https://www.safjan.com/theme/js/theme-switcher.js"></script>

<style>
.youtube-embed {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    background: #000;
    border-radius: 0.375rem;
    overflow: hidden;
}
.youtube-embed iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
}
.youtube-embed-wrapper {
    margin-bottom: 1rem;
}
.youtube-embed-info {
    padding: 0.5rem 0.75rem;
    background: var(--color-bg-secondary, #f6f8fa);
    border-radius: 0 0 0.375rem 0.375rem;
    font-size: 0.875rem;
    margin-top: -0.375rem;
}
.youtube-embed-info a {
    text-decoration: none;
    color: inherit;
}
.youtube-embed-info a:hover {
    text-decoration: underline;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('pre > code').forEach(function(code) {
        var text = code.textContent.trim();
        if (!text.match(/^https?:\/\/(www\.)?(youtube\.com|youtu\.be)/)) return;

        var lines = text.split('\n');
        var url = lines[0].trim();
        var match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/);
        if (!match) return;
        var videoId = match[1];

        var meta = {};
        lines.slice(1).forEach(function(line) {
            var m = line.match(/^(\w+):\s*(.+)$/);
            if (m) meta[m[1].toLowerCase()] = m[2].trim();
        });

        var wrapper = document.createElement('div');
        wrapper.className = 'youtube-embed-wrapper';

        var embed = document.createElement('div');
        embed.className = 'youtube-embed';
        embed.innerHTML = '<iframe src="https://www.youtube-nocookie.com/embed/' + videoId +
            '" allowfullscreen loading="lazy" title="' + (meta.title || 'YouTube video').replace(/"/g, '&quot;') + '"></iframe>';
        wrapper.appendChild(embed);

        if (meta.title || meta.author) {
            var info = document.createElement('div');
            info.className = 'youtube-embed-info';
            var html = meta.title ? '<strong>' + meta.title + '</strong>' : '';
            if (meta.author) {
                html += (meta.title ? ' &bull; ' : '');
                html += meta.authorurl ? '<a href="' + meta.authorurl + '" target="_blank" rel="noopener">' + meta.author + '</a>' : meta.author;
            }
            info.innerHTML = html;
            wrapper.appendChild(info);
        }
        code.closest('pre').replaceWith(wrapper);
    });
});
</script>
</body>
</html>