
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="color-scheme" content="light dark"/>
    <script>
      (function() {
        var theme = localStorage.getItem('theme-preference');
        if (theme === 'dark' || theme === 'light') {
          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"/>
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
              rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/stylesheet/style.css">


    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/pygments/github.min.css">


    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/font-awesome/css/solid.css">

    <link rel="stylesheet" href="http://127.0.0.1:8000/pagefind/pagefind-ui.css">

        <link rel="stylesheet" type="text/css"
              href="http://127.0.0.1:8000/styles/custom.css">








    <meta name="author" content="Krystian Safjan"/>
    <meta name="description" content="Discover how the SHAP method can help you understand the important factors behind your model&#39;s predictions in a simple, intuitive way."/>
    <meta name="keywords" content="machine-learning, python, shap, xai, explainable-ai, rai, responsible-ai">


  <meta property="og:site_name" content="Krystian Safjan's Blog"/>
  <meta property="og:title" content="SHAP - Understanding How This Method for Explainable AI Works"/>
  <meta property="og:description" content="Discover how the SHAP method can help you understand the important factors behind your model&#39;s predictions in a simple, intuitive way."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="http://127.0.0.1:8000/how-the-shap-method-for-explainable-ai-works/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-04-14 00:00:00+02:00"/>
  <meta property="article:modified_time" content="2023-04-14 00:00:00+02:00"/>
  <meta property="article:author" content="http://127.0.0.1:8000/author/krystian-safjan/"/>
  <meta property="article:section" content="Responsible AI"/>
  <meta property="article:tag" content="machine-learning"/>
  <meta property="article:tag" content="python"/>
  <meta property="article:tag" content="shap"/>
  <meta property="article:tag" content="xai"/>
  <meta property="article:tag" content="explainable-ai"/>
  <meta property="article:tag" content="rai"/>
  <meta property="article:tag" content="responsible-ai"/>
  <meta property="og:image" content="http://127.0.0.1:8000//images/head/shap.jpg"/>
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="http://127.0.0.1:8000//images/head/shap.jpg"/>
    <meta name="twitter:image:alt" content="SHAP - Understanding How This Method for Explainable AI Works"/>


    <meta name="twitter:site" content="@izikeros"/>
    <meta name="twitter:creator" content="@izikeros"/>
    <meta name="twitter:title" content="SHAP - Understanding How This Method for Explainable AI Works"/>
    <meta name="twitter:description" content="Discover how the SHAP method can help you understand the important factors behind your model's predictions in a simple, intuitive way."/>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://127.0.0.1:8000/how-the-shap-method-for-explainable-ai-works/"
  },
  "headline": "SHAP - Understanding How This Method for Explainable AI Works",
  "datePublished": "2023-04-14T00:00:00+02:00",
  "dateModified": "2023-04-14T00:00:00+02:00",
  "author": {
    "@type": "Person",
    "name": "Krystian Safjan",
    "url": "http://127.0.0.1:8000/author/krystian-safjan/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Krystian Safjan's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/profile_new.jpg"
    }  },
"image": "http://127.0.0.1:8000//images/head/shap.jpg",  "url": "http://127.0.0.1:8000/how-the-shap-method-for-explainable-ai-works/",
  "description": "Discover how the SHAP method can help you understand the important factors behind your model's predictions in a simple, intuitive way."
}
</script>

    <title>    SHAP - Understanding How This Method for Explainable AI Works
</title>



<!-- Google Automatic Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9767732578835199"
     crossorigin="anonymous"></script>
<!-- End of Google Automatic Ads -->


</head>
<body>
<div id="reading-progress" class="reading-progress"></div>
<aside>
    <div>
        <a href="http://127.0.0.1:8000/">
                <img src="/images/profile_new.jpg" alt="Krystian Safjan's Blog" title="Krystian Safjan's Blog" width="140" height="140">
        </a>

        <h1>
            <a href="http://127.0.0.1:8000/">Krystian Safjan's Blog</a>
        </h1>

<p>Data Scientist | Researcher | Team Leader<br><br> working at Ernst &amp; Young and writing about <a href="/category/machine-learning.html">Data Science and Visualization</a>, on <a href="/category/machine-learning.html">Machine Learning, Deep Learning</a> and <a href="/tag/nlp/">NLP</a>. There are also some <a href="/category/howto.html">howto</a> posts on tools and workflows.</p>


        <ul class="social">
                <li>
                    <a  class="sc-linkedin" href="https://pl.linkedin.com/in/krystiansafjan"
                       target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/izikeros"
                       target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-envelope" href="mailto:ksafjan@gmail.com"
                       target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-graduation-cap" href="https://scholar.google.pl/citations?user=UlNJgMoAAAAJ"
                       target="_blank">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </li>
                <li>
                    <a  class="sc-rss" href="/feeds/all.rss.xml"
                       target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>

<div class="promo-box">
    <a href="https://ksafjanuser.gumroad.com/l/mlops" class="promo-box-image">
        <img src="/images/mlop_interview_book_cover_3D_300px.jpg" alt="MLOps Interview Book Cover">
    </a>
    
    <p class="promo-box-headline">Ace Your MLOps Interview</p>
    
    <a href="https://ksafjanuser.gumroad.com/l/mlops" class="promo-box-cta">
        Get for $2.99
    </a>
    
    <p class="promo-box-features">50 Q&A â€¢ PDF/ePUB/mobi</p>
</div>
</aside>
<main>

        <nav>
            <a href="http://127.0.0.1:8000/">Home</a>

                <a href="/archives.html">Articles</a>
                <a href="/til.html">Notes</a>
                <a href="/categories.html">Categories</a>
                <a href="/pdfs/Krystian_Safjan_resume_priv.pdf">Resume</a>



            <div id="search" class="nav-search"></div>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
            </button>
        </nav>

    <article class="single">
        <header>
                
            <p>
                <!-- Posted on: -->
                2023-04-14 


                    <span class="share-icons">
                        <a href="https://twitter.com/intent/tweet?text=SHAP%20-%20Understanding%20How%20This%20Method%20for%20Explainable%20AI%20Works&url=http%3A//127.0.0.1%3A8000/how-the-shap-method-for-explainable-ai-works/&via=izikeros&hashtags=machine-learning,python,shap,xai,explainable-ai,rai,responsible-ai" target="_blank" title="Share on Twitter" class="share-icon"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//127.0.0.1%3A8000/how-the-shap-method-for-explainable-ai-works/" target="_blank" title="Share on Facebook" class="share-icon"><i class="fab fa-facebook"></i></a>
                        <a href="https://news.ycombinator.com/submitlink?t=SHAP%20-%20Understanding%20How%20This%20Method%20for%20Explainable%20AI%20Works&u=http%3A//127.0.0.1%3A8000/how-the-shap-method-for-explainable-ai-works/" target="_blank" title="Share on Hacker News" class="share-icon"><i class="fab fa-hacker-news"></i></a>
                        <a href="https://www.reddit.com/submit?url=http%3A//127.0.0.1%3A8000/how-the-shap-method-for-explainable-ai-works/&title=SHAP%20-%20Understanding%20How%20This%20Method%20for%20Explainable%20AI%20Works" target="_blank" title="Share on Reddit" class="share-icon"><i class="fab fa-reddit"></i></a>
                    </span>
                <br/>
            </p>
            <h1 id="how-the-shap-method-for-explainable-ai-works">SHAP - Understanding How This Method for Explainable AI Works</h1>
            <div class="header-underline"></div>
                <p class="summary"><p>Discover how the SHAP method can help you understand the important factors behind your model's predictions in a simple, intuitive way.</p></p>

                <div style="width: 100%; padding-bottom: 30px; position: relative;">
                    <a href="http://127.0.0.1:8000/how-the-shap-method-for-explainable-ai-works/">
                        <img style="width: 100%; "
                             src="/images/head/shap.jpg" alt="">
                    </a>
                </div>


        </header>



        <details class="toc-details" id="toc-container">
            <summary>Table of Contents</summary>
            <nav class="toc" aria-label="Table of Contents">
                <ul class="toc-list"></ul>
            </nav>
        </details>

        <div class="article-content">
            <p>As a data scientist, one of the biggest challenges in deploying machine learning models is explaining how the model makes its decisions. The need for explainability is not only important for legal and ethical reasons, but it also helps in building trust in the model and making informed decisions. The <strong>SHapley Additive exPlanations</strong> (SHAP) method is a powerful technique that provides a unified framework for interpreting any model. In this blog post, I will explain the SHAP method, its mathematical foundation, and how it can be applied to interpret machine learning models.</p>
<h2 id="what-is-shap">What is SHAP?</h2>
<p>The SHAP method is a game-theoretic approach to explain the output of any machine learning model. It is based on the concept of Shapley values. Here is a timeline for the SHAP method:</p>
<ul>
<li>1953: Introduction of Shapley values by Lloyd Shapley for game theory</li>
<li>2010: First use of Shapley values for explaining machine learning predictions by Strumbelj and Kononenko  </li>
<li>2017: SHAP paper + Python package by Lundberg</li>
</ul>
<p>The SHAP method is a game-theoretic approach to explain the output of any machine learning model. It is based on the concept of Shapley values, which were introduced by Lloyd Shapley in 1953 to fairly distribute the gains of a cooperative game among its players. In the context of machine learning, the players are the input features, and the gain is the difference between the actual output of the model and the expected output. The SHAP method provides a way to calculate the Shapley values for each input feature, which gives us a measure of the contribution of each feature towards the model output.</p>
<p>The SHapley Additive exPlanations (SHAP) method we are using today was introduced in a paper titled "A Unified Approach to Interpreting Model Predictions" by Scott Lundberg and Su-In Lee, published in the Proceedings of the 31st International Conference on Neural Information Processing Systems (NIPS 2017). The paper is available on the arXiv preprint server at <a href="https://arxiv.org/abs/1705.07874">https://arxiv.org/abs/1705.07874</a>.</p>
<h2 id="how-does-shap-work">How does SHAP work?</h2>
<p>The SHAP method works by computing the Shapley values for each feature in the input space. The Shapley value for feature i, denoted by <span class="math">\(\phi_i\)</span>, is defined as the average contribution of the feature i across all possible coalitions of features. Mathematically, the Shapley value can be expressed as follows:</p>
<div class="math">$$\phi_i(f,S) = \sum_{T \subseteq S \setminus \{i\}}\frac{|T|!(|S|-|T|-1)!}{|S|!}(f(T \cup \{i\}) - f(T))$$</div>
<p>where <span class="math">\(X\)</span> is the set of all input features, <span class="math">\(S\)</span> is a coalition of features that does not include feature <span class="math">\(i\)</span>, <span class="math">\(|S|\)</span> is the size of the coalition, and <span class="math">\(f(S\cup{i})\)</span> is the output of the model when the features in <span class="math">\(S\)</span> and <span class="math">\(i\)</span> are present. The term <span class="math">\(f(S)\)</span> is the output of the model when only the features in <span class="math">\(S\)</span> are present. The Shapley value represents the average marginal contribution of feature <span class="math">\(i\)</span> over all possible coalitions.</p>
<p>To compute the Shapley values using the above formula, we need to evaluate the model output for all possible coalitions of features, which is computationally infeasible for most machine learning models. The SHAP method provides an efficient way to estimate the Shapley values using a weighted average of the model outputs for a subset of coalitions. The subset of coalitions is selected based on a feature importance metric, such as the permutation importance or the gradient-based importance.</p>
<h2 id="how-to-apply-shap">How to apply SHAP?</h2>
<p>To apply the SHAP method, we need to first compute the Shapley values for each feature in the input space. This can be done using one of the many implementations available in popular machine learning libraries, such as scikit-learn, XGBoost, and TensorFlow. Once we have the Shapley values, we can visualize them using various techniques to gain insights into the model's decision-making process.</p>
<p>One popular technique to visualize the Shapley values is the Shapley value plot, which shows the contribution of each feature towards the model output for each individual data point. The plot consists of a horizontal axis representing the feature contribution, and a vertical axis representing the features. Each data point is represented by a vertical bar, where the length of the bar represents the magnitude of the Shapley value for the corresponding feature. The color of the bar represents the value of the feature, where red represents high feature values and blue represents low feature values. The plot helps in identifying the most important features for each data point and the direction of the relationship between the features and the output.</p>
<p>Another technique to visualize the Shapley values is the summary plot, which shows the average contribution of each feature across all data points. The plot consists of a horizontal axis representing the Shapley value and a vertical axis representing the features. Each feature is represented by a horizontal bar, where the length of the bar represents the magnitude of the average Shapley value. The color of the bar represents the direction of the relationship between the feature and the output, where red represents a positive relationship and blue represents a negative relationship.</p>
<p>In addition to visualizing the Shapley values, the SHAP method can also be used to identify instances where the model makes biased or unfair decisions. The method can be used to quantify the extent to which each feature contributes to the model's bias towards a certain group or class. This helps in identifying the root cause of the bias and taking corrective measures to ensure fairness and equity in the model's decisions.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The SHapley Additive exPlanations (SHAP) method provides a powerful framework for interpreting any machine learning model. The method is based on the concept of Shapley values, which provides a fair way to distribute the gain of a cooperative game among its players. The SHAP method provides an efficient way to compute the Shapley values for each feature in the input space, which gives us a measure of the contribution of each feature towards the model output. The method can be applied to visualize the Shapley values, identify the most important features, and quantify the model's bias towards certain groups or classes. By providing a unified framework for interpretability, the SHAP method helps in building trust in the model and making informed decisions.</p>
<p><em>Any comments or suggestions? <a href="mailto:ksafjan@gmail.com?subject=Blog+post">Let me know</a>.</em></p>
<ul>
<li><a href="http://127.0.0.1:8000/how-the-lime-method-for-explainable-ai-works/">LIME - Understanding How This Method for Explainable AI Works</a></li>
<li><a href="http://127.0.0.1:8000/lime-tutorial/">LIME Tutorial</a></li>
<li></li>
</ul>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
        </div>




            <div class="bibtex-note">
                <p><b>To cite this article:</b></p>
                <pre>@article{Saf2023SHAP,
    author  = {Krystian Safjan},
    title   = {SHAP - Understanding How This Method for Explainable AI Works},
    journal = {Krystian's Safjan Blog},
    year    = {2023},
}</pre>
            </div>
        <div class="article-tags">
            <span class="tags-label">Tags:</span>
                <a href="http://127.0.0.1:8000/tag/machine-learning/" class="article-tag">machine-learning</a>
                <a href="http://127.0.0.1:8000/tag/python/" class="article-tag">python</a>
                <a href="http://127.0.0.1:8000/tag/shap/" class="article-tag">shap</a>
                <a href="http://127.0.0.1:8000/tag/xai/" class="article-tag">xai</a>
                <a href="http://127.0.0.1:8000/tag/explainable-ai/" class="article-tag">explainable-ai</a>
                <a href="http://127.0.0.1:8000/tag/rai/" class="article-tag">rai</a>
                <a href="http://127.0.0.1:8000/tag/responsible-ai/" class="article-tag">responsible-ai</a>
        </div>





            <div class="related-posts">
                <h4 class="related-posts-title">You might also like</h4>
                <div class="related-posts-grid">
                        <a href="http://127.0.0.1:8000/anchor-explanations/" class="related-post-card">
                            <span class="related-post-title">Explainable AI - Anchor Explanations</span>
                            <span class="related-post-date">Feb 20, 2023</span>
                        </a>
                        <a href="http://127.0.0.1:8000/attacking-differential-privacy-using-the-correlation-between-the-features/" class="related-post-card">
                            <span class="related-post-title">Attacking Differential Privacy Using the Correlation Between the Features</span>
                            <span class="related-post-date">Apr 19, 2023</span>
                        </a>
                        <a href="http://127.0.0.1:8000/how-the-lime-method-for-explainable-ai-works/" class="related-post-card">
                            <span class="related-post-title">LIME - Understanding How This Method for Explainable AI Works</span>
                            <span class="related-post-date">Apr 14, 2023</span>
                        </a>
                        <a href="http://127.0.0.1:8000/evaluation-of-interpretability-for-explainable-ai/" class="related-post-card">
                            <span class="related-post-title">Evaluation of Interpretability for Explainable AI</span>
                            <span class="related-post-date">Nov 05, 2020</span>
                        </a>
                </div>
            </div>




    </article>

    <footer>
<p>
  &copy; 2026 Krystian Safjan - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>    </footer>
</main>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Krystian Safjan's Blog",
  "url": "http://127.0.0.1:8000",
"image": "/images/profile_new.jpg",  "description": ""
}
</script>


<script src="http://127.0.0.1:8000/pagefind/pagefind-ui.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', function() {
        new PagefindUI({
            element: "#search",
            showSubResults: false,
            showImages: false
        });
    });
</script>

<script src="http://127.0.0.1:8000/theme/js/theme-switcher.js"></script>
</body>
</html>